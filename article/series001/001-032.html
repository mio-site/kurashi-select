<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>【2025年版】育児ママのためのスマートウォッチおすすめ10選！家事や仕事もはかどる選び方も解説</title>

    <!-- SEO & Viewport Meta Tags -->
    <meta name="description" content="育児中のママ向けスマートウォッチおすすめ10選【2025年版】。LINE通知、育児記録、睡眠管理など、便利な機能で忙しい毎日をサポート。選び方のポイントも解説し、あなたにぴったりの1台を見つけるお手伝いをします。">
    <meta content='width=device-width,initial-scale=1.0,minimum-scale=1.0' name='viewport'/>
    <meta name="theme-color" content="#A88767">

    <!-- Canonical & OGP/Twitter -->
    <link rel="canonical" href="/article/series001/001-032.html">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="kurashi-select">
    <meta property="og:locale" content="ja_JP">
    <meta property="og:title" content="【2025年版】育児ママのためのスマートウォッチおすすめ10選！家事や仕事もはかどる選び方も解説">
    <meta property="og:description" content="育児中のママ向けスマートウォッチおすすめ10選【2025年版】。LINE通知、育児記録、睡眠管理など、便利な機能で忙しい毎日をサポート。選び方のポイントも解説し、あなたにぴったりの1台を見つけるお手伝いをします。">
    <meta property="og:url" content="/article/series001/001-032.html">
    <meta property="og:image" content="../../icon.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="【2025年版】育児ママのためのスマートウォッチおすすめ10選！家事や仕事もはかどる選び方も解説">
    <meta name="twitter:description" content="育児中のママ向けスマートウォッチおすすめ10選【2025年版】。LINE通知、育児記録、睡眠管理など、便利な機能で忙しい毎日をサポート。選び方のポイントも解説し、あなたにぴったりの1台を見つけるお手伝いをします。">
    <meta name="twitter:image" content="../../icon.png">

    <!-- Icons & PWA -->
    <link rel="icon" type="image/png" href="../../icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
    <link rel="manifest" href="../../manifest.webmanifest">

    <!-- Tailwindは初期描画で必要なため defer しない -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js は動的ロードに変更（初期描画を軽くする） -->
    <!-- 共通ルート設定 -->
    <script>
      // routes.js を埋め込み
      (function(){
  // ルーティング定義を一元管理
  // 後からパスを変更しても、このファイルだけ直せば全ページに反映されます

  function slugify(input) {
    if (!input) return '';
    return String(input)
      .normalize('NFKD')
      .replace(/[\u0300-\u036f]/g, '')
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/(^-|-$)+/g, '');
  }

  // ルート基準パス（GitHub Pagesのユーザー/組織サイトなら空文字でOK）
  var BASE = '';
  function path(p){ return BASE + p; }

  // 比較（まとめ）記事の登録
  var compare = {
    series001: path('/article/series001/001-001.html')
    // 必要に応じて追加: series002: path('/article/series002/002-001.html'),
  };

  // 個別記事（商品）の登録: key はスラッグ
  var products = {
    // デモ: Monomam Primo（003-001.html）
    'monomam-primo': path('/article/series003/003-001.html')
  };

  // 名前→URLの直参照（日本語名などスラッグ化が困難な場合はこちらを優先）
  var productByName = {
    'Monomam Primo': products['monomam-primo']
    // 例: '＼18％OFFクーポン／UV パーカー 冷感 -7℃': path('/article/items/uv-parka.html')
  };

  // 個別→関連比較記事への逆引き（任意）
  var productCompare = {
    'monomam-primo': compare.series001 // デモとして series001 を関連に設定
  };

  // 公開
  window.AppRoutes = {
    slugify: slugify,
    compare: compare,
    products: products,
    productByName: productByName,
    productCompare: productCompare
  };
})();



    </script>

    <!-- Stylesheets (CSS 遅延読み込みを適用) -->
    <!-- DNS Prefetch / Preconnect for external resources -->
    <link rel="dns-prefetch" href="//hb.afl.rakuten.co.jp">
    <link rel="dns-prefetch" href="//thumbnail.image.rakuten.co.jp">
    <link rel="preconnect" href="https://hb.afl.rakuten.co.jp" crossorigin>
    <link rel="preconnect" href="https://thumbnail.image.rakuten.co.jp" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <style>
        :root {
            /* 高コントラストな配色に調整 */
            --bg: #FAFAFA;
            --text: #1A1A1A;
            --primary: #2563EB; /* Primary: 青 */
            --accent: #6B7280;  /* Secondary: ニュートラル */
            --card: #FFFFFF;
            --muted: #4B5563; /* gray-600 相当 */
        }
        .dark {
            --bg: #0F172A;     /* slate-900 */
            --text: #E5E7EB;   /* gray-200 */
            --primary: #93C5FD;/* blue-300 */
            --accent: #9CA3AF; /* gray-400 */
            --card: #0B1220;   /* 少し暗いカード */
            --muted: #9CA3AF;  /* gray-400 */
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.75;
            font-size: 18px; /* 本文を16→18pxに拡大 */
            font-variant-numeric: tabular-nums; /* 価格表示の桁を揃える */
        }
        .bg-primary { background-color: var(--primary); }
        .text-primary { color: var(--primary); }
        .border-primary { border-color: var(--primary); }
        .bg-accent { background-color: var(--accent); }
        .border-accent { border-color: var(--accent); }
        .text-muted { color: var(--muted); }
        /* ヒーローのリード文はコントラスト強めに */
        .hero-lead { color: #111827; opacity: 1; }
        .dark .hero-lead { color: #E5E7EB; }
        .transition-all { transition: all 0.3s ease-in-out; }
        .transform-gpu { transform: translateZ(0); }
        .card-shadow { box-shadow: 0 8px 24px rgba(0,0,0,0.06); }
        .card-shadow-hover:hover { box-shadow: 0 12px 28px rgba(0,0,0,0.10); }
        .chart-container { position: relative; height: 450px; width: 100%;}
        .dark .bg-white { background-color: var(--card); }
        .dark .text-gray-600 { color: var(--muted); }
        .dark .text-gray-700 { color: var(--text); }
        .dark .text-gray-800 { color: var(--text); }
        .dark .text-gray-900 { color: var(--text); }
        .dark .text-gray-500 { color: #9CA3AF; }
        .chip { display: inline-flex; align-items: center; border: 1px solid #E5E7EB; padding: 6px 10px; border-radius: 9999px; font-size: 13px; background: #fff; color: #374151; white-space: nowrap; }
        .dark .chip { background: var(--card); color: var(--text); border-color: rgba(148,163,184,0.35); }
        a.chip, button.chip { cursor: pointer; transition: box-shadow .2s ease, transform .08s ease; }
        a.chip:hover, button.chip:hover { box-shadow: 0 8px 18px rgba(0,0,0,0.06); transform: translateY(-1px); }
        .chip-selected { outline: 2px solid var(--primary); background-color: rgba(37, 99, 235, 0.08); }
        .dark .chip-selected { background-color: rgba(147,197,253,0.16); }
        .sticky-bar { position: sticky; bottom: 12px; z-index: 40; }
        .floating { position: fixed; right: 16px; bottom: 16px; z-index: 50; }
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.35); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal { position: relative; max-width: 960px; width: calc(100% - 2rem); background: var(--card); color: var(--text); border-radius: 16px; box-shadow: 0 25px 50px rgba(0,0,0,0.2); max-height: 92vh; overflow: auto; -webkit-overflow-scrolling: touch; }
        .modal-header { position: sticky; top: 0; background: var(--card); z-index: 5; border-bottom: 1px solid rgba(0,0,0,0.06); }
        body.modal-open { overflow: hidden; }
        .range { accent-color: var(--primary); }
        .btn { cursor: pointer; }
        .btn-outline-primary { border: 2px solid var(--primary); color: var(--primary); background: transparent; }
        .btn-outline-primary:hover { background: rgba(37,99,235,0.08); }
        .dark .btn-outline-primary:hover { background: rgba(147,197,253,0.16); }
        .highlight-ring { box-shadow: 0 0 0 4px rgba(37,99,235,0.35) inset; transition: box-shadow .3s ease; }
        /* アクションUI（カード下部） */
        .btn-chip { display:inline-flex; align-items:center; gap:8px; height:40px; padding:0 12px; border:1px solid #E5E7EB; border-radius:10px; background:#fff; color:#374151; font-size:14px; }
        .btn-chip:hover { box-shadow: 0 8px 18px rgba(0,0,0,0.06); }
        .btn-chip input[type="checkbox"]{ width:18px; height:18px; accent-color: var(--primary); }
        .dark .btn-chip { background: var(--card); color: var(--text); border-color: rgba(148,163,184,0.35); }
        .actions-row { display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
        .action-link { display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:8px; background: rgba(37,99,235,0.08); color: var(--primary); font-weight:700; }
        .action-link:hover{ background: rgba(37,99,235,0.14); text-decoration:none; }
        .dark .action-link{ background: rgba(147,197,253,0.16); }
        /* 強調CTAカラー */
        :root { --cta: #F59E0B; }
        .dark { --cta: #F3B34D; }
        .bg-cta { background-color: var(--cta); }
        .text-cta { color: var(--cta); }
        .btn-cta { background-color: var(--cta); color: #fff; }
        /* 行の折りたたみ（商品名短縮） */
        .line-clamp-2 { display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; line-clamp: 2; overflow: hidden; }
        .line-clamp-3 { display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 3; line-clamp: 3; overflow: hidden; }
        /* 比較表のストライプ */
        .table-striped tbody tr:nth-child(even) { background-color: rgba(0,0,0,0.035); }
        .dark .table-striped tbody tr:nth-child(even) { background-color: rgba(255,255,255,0.04); }
        /* TOC スクロール */
        .toc-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }

        /* 「こんなお悩み」リストの視認性改善（大きめチェック） */
        #intro ul { list-style: none; padding-left: 0; }
        #intro ul li { position: relative; padding-left: 1.75rem; }
        #intro ul li::before { content: ''; position: absolute; left: 0; top: .55em; width: 14px; height: 14px; border: 2px solid var(--primary); border-radius: 3px; background: transparent; }
        .dark #intro ul li::before { border-color: var(--primary); }

        /* トップ3カードのモバイル崩れ対策 */
        #top3-container > div { display: flex; flex-direction: column; height: 100%; }
        #top3-container img { aspect-ratio: 1 / 1; object-fit: contain; }
        #top3-container .p-5, #top3-container .p-6 { display: flex; flex-direction: column; gap: .5rem; flex: 1; }
        #top3-container a.btn-cta { margin-top: auto; }

        /* アクセシビリティ: フォーカスリング/リンク */
        a { color: var(--primary); }
        a:hover { text-decoration: underline; text-underline-offset: 2px; }
        :focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; }

        /* フィルタ値の強調 */
        #label-rating, #label-review { color: var(--primary); font-weight: 700; }

        /* スライダーの可用性改善（大きめのつまみ） */
        input[type="range"] { -webkit-appearance: none; appearance: none; height: 6px; border-radius: 9999px; background: #E5E7EB; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 22px; height: 22px; border-radius: 9999px; background: var(--primary); border: 2px solid #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.15); }
        input[type="range"]::-moz-range-thumb { width: 22px; height: 22px; border-radius: 9999px; background: var(--primary); border: 2px solid #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.15); }

        /* FAQ 開状態の視覚的差分 */
        #faq details[open] { background: rgba(37,99,235,0.04); }
        #faq summary { font-size: 1.05rem; }

        /* ラベル色の統一（バッジ） */
        .badge-primary { background-color: rgba(37,99,235,0.10); color: var(--primary); }
        .dark .badge-primary { background-color: rgba(147,197,253,0.18); }

        /* SNS共有バー */
        .share-bar { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .share-chip { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border: 1px solid #E5E7EB; border-radius: 9999px; background: #fff; color: #374151; }
        .dark .share-chip { background: var(--card); color: var(--text); border-color: rgba(148,163,184,0.35); }
        .share-chip:hover { box-shadow: 0 8px 18px rgba(0,0,0,0.06); transform: translateY(-1px); }
        .share-chip svg { width: 18px; height: 18px; }
        .icon-bg { display:inline-flex; width:22px; height:22px; border-radius:9999px; align-items:center; justify-content:center; color:#fff; }
        .share-chip[data-share-action='x'] .icon-bg { background:#000; }
        .share-chip[data-share-action='line'] .icon-bg { background:#06C755; }
        .share-chip[data-share-action='copy'] .icon-bg { background:#6B7280; }
        .share-chip[data-share-action='native'] .icon-bg { background: var(--primary); }

        /* フローティング共有ボタン（スマホ） */
        .floating-left { position: fixed; left: 16px; bottom: 16px; z-index: 50; }
        
        /* Busy軽減: シェアUIの集約（上部/FABを非表示） */
        #share-top, #share-fab-wrap { display: none !important; }
        
        /* --- 追加: 極小グローバルヘッダー --- */
        .site-header { position: fixed; inset-inline: 0; top: 0; z-index: 60; backdrop-filter: saturate(180%) blur(12px); transition: transform .25s ease, background-color .2s ease; }
        .site-header-inner { display: flex; align-items: center; justify-content: space-between; gap: 12px; max-width: 1200px; margin: 0 auto; padding: 10px 16px; }
        .site-header.hide { transform: translateY(-100%); }
        .site-logo { font-weight: 800; letter-spacing: .2px; }
        .site-nav { display: none; gap: 12px; }
        .site-nav a { display: inline-flex; align-items: center; padding: 8px 10px; border-radius: 9999px; text-decoration: none; font-size: 14px; }
        @media (min-width: 768px){ .site-nav{ display: inline-flex; } }
        .dark .site-header { background-color: rgba(11, 18, 32, 0.72); }
        .site-header { background-color: rgba(255,255,255,0.85); }
        body.has-header { padding-top: 56px; }

        /* ダーク背景での淡色系の調整 */
        .dark .bg-stone-50 { background-color: rgba(255,255,255,0.06); }
        .dark img.bg-white { background-color: transparent; }
        .dark .card-shadow { box-shadow: 0 8px 24px rgba(0,0,0,0.45); }

        /* --- 追加: 右サイドTOC（デスクトップ限定） --- */
        .right-toc { display: none; position: fixed; top: 96px; right: 16px; width: 220px; max-height: calc(100vh - 140px); overflow: auto; padding: 12px; border-radius: 12px; background: rgba(255,255,255,0.78); backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.06); box-shadow: 0 8px 24px rgba(0,0,0,0.06); z-index: 40; transition: opacity .2s ease, transform .2s ease; }
        .right-toc.hidden { opacity: 0; pointer-events: none; transform: translateX(8px); }
        .right-toc h3 { font-size: 14px; font-weight: 700; margin-bottom: 8px; color: var(--primary); }
        .right-toc a { display: block; padding: 8px 10px; border-radius: 8px; color: inherit; text-decoration: none; font-size: 14px; }
        .right-toc a:hover { background: rgba(37,99,235,0.08); }
        .right-toc a.active { background: rgba(37,99,235,0.12); font-weight: 700; }
        .dark .right-toc { background: rgba(11,18,32,0.65); border-color: rgba(148,163,184,0.35); }
        /* 1280px以上で表示。コンテンツの外に寄せつつ、画面端から16pxは確保 */
        @media (min-width: 1280px){ .right-toc{ display: block; right: auto; left: min(calc(100vw - 16px - 220px), calc(50% + 600px + 16px)); } }
        
        /* 目次トグル（デスクトップのみ） */
        .toc-toggle { position: fixed; top: 96px; right: 16px; width: 42px; height: 42px; border: 1px solid rgba(0,0,0,0.08); border-radius: 9999px; display: none; align-items: center; justify-content: center; background: rgba(37,99,235,0.85); color: #fff; box-shadow: 0 8px 24px rgba(0,0,0,0.08); z-index: 41; cursor: pointer; }
        .toc-toggle:hover{ filter: brightness(1.05); }
        .dark .toc-toggle{ background: rgba(147,197,253,0.85); color: #0b1220; border-color: rgba(148,163,184,0.35); }
        @media (min-width: 1280px){ .toc-toggle{ display: inline-flex; right: auto; left: min(calc(100vw - 16px - 42px), calc(50% + 600px + 16px)); } }

        /* 価格帯（モバイルではみ出し防止） */
        @media (max-width: 639px){
            #controls .flex.items-center.gap-2{ flex-wrap: wrap; }
            #price-range{ flex: 0 0 100%; width: 100%; min-width: 0; box-sizing: border-box; margin-top: 6px; }
        }
    </style>
</head>
<body id="top" class="antialiased">

    <!-- 極小グローバルヘッダー（スクロールで隠れる） -->
    <div id="site-header" class="site-header">
        <div class="site-header-inner">
            <a href="../../index.html" class="site-logo text-primary">kurashi-select</a>
            <nav class="site-nav" aria-label="グローバルナビ">
                <a href="#toc">目次</a>
                <a href="#interactive-selection">商品</a>
                <a href="#faq">FAQ</a>
                <a href="#conclusion">まとめ</a>
            </nav>
            <div class="flex items-center gap-2">
                <button id="btn-dark-toggle" class="btn bg-accent text-white px-3 py-2 rounded-xl card-shadow-hover" aria-pressed="false" title="ダーク/ライト切替">🌙 ダーク</button>
            </div>
        </div>
    </div>

    <!-- 右サイド目次（デスクトップ限定・ScrollSpy） -->
    <nav id="right-toc" class="right-toc" aria-label="ページ内目次">
        <h3>ページ内</h3>
        <a href="#top3">👑 トップ3</a>
        <a href="#controls">🔎 絞り込み</a>
        <a href="#chart-analysis">📈 グラフ</a>
        <a href="#interactive-selection">🛍 商品一覧</a>
        <a href="#faq">❓ FAQ</a>
        <a href="#conclusion">✅ まとめ</a>
    </nav>
    <button id="toc-toggle" class="toc-toggle" aria-label="ページ内目次を表示/隠す">目次</button>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-20">

        <header class="text-center mb-10 md:mb-16">
            <h1 class="text-3xl md:text-5xl font-bold text-primary mb-3">2025年版｜育児ママ向けスマートウォッチおすすめ10選！LINE通知も見逃さず、家事・仕事も効率アップ</h1>
            <p class="hero-lead text-xl md:text-2xl font-medium mb-4">忙しい育児中のママにおすすめのスマートウォッチを厳選！LINE通知はもちろん、育児記録、睡眠管理など、便利な機能で毎日の生活をサポートします。選び方のポイントも解説するので、自分にぴったりのスマートウォッチを見つけて、快適な育児ライフを送りましょう。</p>
            
            <p class="hero-lead max-w-3xl mx-auto text-base md:text-lg leading-relaxed font-medium">毎日時間に追われる育児ママにとって、スマートウォッチは強い味方。スマホを見ずに通知を確認できたり、スケジュール管理をしたり、睡眠の質を把握したり。家事・育児・仕事に忙しいママのために、2025年のおすすめスマートウォッチ10選と選び方のポイントを紹介します。</p>
            
            <div class="flex justify-center">
                <a href="#interactive-selection" class="btn-cta font-bold py-3 px-6 rounded-full shadow hover:opacity-95" aria-label="商品一覧へ移動">商品一覧へ</a>
            </div>
        </header>
        
        <!-- シェアバー（トップ）-- 非表示（Busy軽減のため下部のみ残す） -->
        <section id="share-top" class="max-w-4xl mx-auto mb-8 md:mb-12" aria-label="この記事を共有" hidden>
            <div class="bg-white dark:bg-opacity-80 backdrop-blur-sm p-3 sm:p-4 rounded-2xl card-shadow">
                <div class="share-bar" role="group" aria-label="共有ボタン">
                    <button type="button" class="btn share-chip text-sm" data-share-action="native" aria-label="OSの共有シートを開く">
                        <span class="icon-bg" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 7l4-4 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><rect x="4" y="11" width="16" height="9" rx="2" stroke="currentColor" stroke-width="2"/></svg>
                        </span>
                        OSで共有
                    </button>
                    <button type="button" class="btn share-chip text-sm" data-share-action="x" aria-label="Xでシェア">
                        <span class="icon-bg" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M4 4h4l4 6 4-6h4l-6.5 9L20 20h-4l-4-6-4 6H4l6.5-9L4 4z"/></svg>
                        </span>
                        Xでシェア
                    </button>
                    <button type="button" class="btn share-chip text-sm" data-share-action="line" aria-label="LINEで送る">
                        <span class="icon-bg" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M20 11c0 4.418-4.03 8-9 8-1.036 0-2.03-.145-2.95-.412L4 20l1.59-3.18C4.62 15.53 4 13.83 4 12c0-4.418 4.03-8 9-8s7 3.582 7 7z"/><path fill="#fff" d="M9 9h2v6H9zM12.5 9H15c1.2 0 2 .8 2 2s-.8 2-2 2h-1v2h-1.5V9zm1.5 1.5V12h1c.4 0 .5-.3.5-.5s-.1-.5-.5-.5h-1z"/></svg>
                        </span>
                        LINEで送る
                    </button>
                    <button type="button" class="btn share-chip text-sm" data-share-action="copy" aria-label="リンクをコピー">
                        <span class="icon-bg" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 17a4 4 0 0 1 0-6l4-4a4 4 0 1 1 6 6l-1 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 7a4 4 0 0 1 0 6l-4 4a4 4 0 1 1-6-6l1-1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </span>
                        リンクをコピー
                    </button>
                </div>
            </div>
        </section>

        <!-- 関連記事（内部リンク強化） -->
        <section id="related" class="max-w-4xl mx-auto mt-10 md:mt-14">
            <div class="bg-white dark:bg-opacity-80 backdrop-blur-sm p-5 md:p-6 rounded-2xl card-shadow">
                <h2 class="text-xl md:text-2xl font-bold mb-3">関連記事</h2>
                <ul class="list-disc ml-5 space-y-1 text-primary">
                    
                    <li><a href="../series001/001-018.html">声で家事をコントロール｜育児が楽になるスマートホーム</a></li>
                    
                    <li><a href="../series001/001-030.html">1万歩歩ける快適さ｜ママのための疲れないスニーカー</a></li>
                    
                </ul>
            </div>
        </section>

        <!-- 以降の本文・UIはサンプルの構造を踏襲（省略不可部分はそのまま） -->
        <section id="intro" class="max-w-3xl mx-auto text-center mt-8 md:mt-10 mb-12 md:mb-16">
            <h2 class="text-2xl md:text-3xl font-bold mb-4">こんなお悩みはありませんか？</h2>
            <div class="bg-stone-50 p-6 rounded-xl mb-6 text-left">
                <ul class="space-y-2 text-gray-700">
                    
                        
                        <li>スマホの通知に気づきにくい。</li>
                        
                        <li>スケジュール管理が大変。</li>
                        
                        <li>睡眠不足が続いている。</li>
                        
                        <li>自分の時間がなかなか取れない。</li>
                        
                        <li>家事や育児で忙しく、自分のことを後回しにしがち。</li>
                        
                    
                </ul>
            </div>
            <p class="text-base md:text-lg leading-relaxed">
                このページでは、<strong>「売れている × レビューが高い」</strong>を軸に、<strong>機能性・体型カバー・コスパ</strong>の三拍子そろった“失敗しにくい”アイテムだけをまとめました。忙しい毎日でも、ラクにきれい見えが叶う一着がきっと見つかります。
            </p>
        </section>

        <!-- 目次（TOC） -->
        <section id="toc" class="max-w-4xl mx-auto mb-10 md:mb-14">
            <div class="bg-white dark:bg-opacity-80 backdrop-blur-sm p-4 sm:p-5 rounded-2xl card-shadow">
                <h2 class="text-xl md:text-2xl font-bold mb-3">目次</h2>
                <div class="toc-scroll">
                    <div class="flex gap-2 sm:gap-3 min-w-max">
                        <a href="#top3" class="chip whitespace-nowrap">👑 トップ3</a>
                        <a href="#controls" class="chip whitespace-nowrap">🔎 絞り込み</a>
                        <a href="#chart-analysis" class="chip whitespace-nowrap">📈 グラフで比較</a>
                        <a href="#interactive-selection" class="chip whitespace-nowrap">🛍 商品一覧</a>
                        <a href="#faq" class="chip whitespace-nowrap">❓ FAQ</a>
                        <a href="#conclusion" class="chip whitespace-nowrap">✅ まとめ</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 総合トップ3（ファーストビュー強化） -->
        <section id="top3" class="mb-10 md:mb-14">
            <div class="max-w-4xl mx-auto text-center mb-8">
                <h2 class="text-2xl md:text-3xl font-bold mb-2">0歳から5歳くらいまでの子育て中で、毎日時間に追われているママ。家事や育児だけでなく、仕事をしているママもいる。スマホの通知に気づきにくい、スケジュール管理が大変、睡眠不足、自分の時間がなかなか取れないなどの悩みを抱えている。が選ぶ！総合トップ3</h2>
                <p class="text-sm md:text-base text-gray-700">“失敗しにくい”おすすめ3品。詳しくは下の一覧でチェック。</p>
            </div>
            <div id="top3-container" class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8"></div>
        </section>

        <!-- コントロールパネル -->
        <section id="controls" class="bg-white dark:bg-opacity-80 backdrop-blur-sm p-4 sm:p-6 md:p-8 rounded-2xl card-shadow max-w-4xl mx-auto mb-12 md:mb-16">
            <div class="flex flex-col gap-4">
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                    <div class="flex-1">
                        <label for="search-box" class="block text-sm mb-1 text-muted">キーワード検索</label>
                        <input id="search-box" type="search" placeholder="例: UV, ワンピース, パンツ…" class="w-full border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50" />
                    </div>
                    <div class="flex gap-2 items-end">
                        <button id="btn-install" class="btn bg-accent text-white px-4 py-3 rounded-xl card-shadow-hover hidden">⬇️ インストール</button>
                        <button id="btn-reset" class="btn btn-outline-primary px-4 py-3 rounded-xl card-shadow-hover">リセット</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm mb-1 text-muted">価格帯（円）</label>
                        <div class="flex items-center gap-2">
                            <input id="price-min" type="number" class="w-28 border rounded-lg px-3 py-2" min="0" step="100" />
                            <span class="text-muted">〜</span>
                            <input id="price-max" type="number" class="w-28 border rounded-lg px-3 py-2" min="0" step="100" />
                            <input id="price-range" type="range" min="0" max="100" value="0" class="range flex-1" aria-label="価格範囲(ショートカット)" />
                        </div>
                    </div>
                    <div>
                        <label for="filter-rating" class="block text-sm mb-1 text-muted">最低評価</label>
                        <input id="filter-rating" type="range" min="0" max="5" step="0.1" value="0" class="range w-full" />
                        <div class="text-xs text-muted mt-1"><span id="label-rating">0.0</span> 以上</div>
                    </div>
                    <div>
                        <label for="filter-review" class="block text-sm mb-1 text-muted">最低レビュー件数</label>
                        <input id="filter-review" type="range" min="0" max="10000" step="100" value="0" class="range w-full" />
                        <div class="text-xs text-muted mt-1"><span id="label-review">0</span> 件以上</div>
                    </div>
                    <div class="flex items-center gap-3">
                        <label class="inline-flex items-center gap-2 text-sm"><input id="filter-fav" type="checkbox" class="accent-[var(--primary)]"><span>お気に入りのみ</span></label>
                        <div class="ml-auto flex gap-2">
                            <button id="btn-sort-score" class="btn bg-primary text-white px-4 py-3 rounded-xl card-shadow-hover">✨ おすすめ順</button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="text-sm mb-2 text-muted">タグで絞り込み</div>
                    <div id="tags-container" class="flex flex-wrap gap-2"></div>
                </div>
                <div class="text-xs text-muted" id="result-summary" aria-live="polite"></div>
            </div>
        </section>

        <section id="chart-analysis" class="mb-16 md:mb-24">
            <div class="max-w-4xl mx-auto text-center mb-4">
                <h2 class="text-2xl md:text-3xl font-bold mb-2">価格と評価の関係：どれを選べば損しない？</h2>
                <p class="text-base md:text-lg text-gray-700">右上（高評価）で円が大きい（レビュー多い）ほど“買って満足”の傾向。気になる点をタップすると該当カードへ移動します。</p>
            </div>
            <details class="max-w-4xl mx-auto bg-white rounded-2xl card-shadow">
                <summary class="list-none cursor-pointer p-4 sm:p-5 md:p-6 flex items-center justify-between">
                    <span class="font-semibold text-primary">人気×価格の関係を見る（グラフを開く）</span>
                    <span class="text-sm text-muted">理解の助けに。買い物は下のリストからすぐ可能です。</span>
                </summary>
                 <div class="p-4 sm:p-6 md:p-8 pt-0">
                     <div class="chart-container min-h-[400px] w-full">
                         <canvas id="productsChart" style="width: 100%; height: 400px;"></canvas>
                     </div>
                     <div class="mt-3 text-sm md:text-base text-gray-700">
                         <p class="font-semibold mb-1">グラフの見方（凡例）</p>
                         <ul class="list-disc ml-5 space-y-1">
                             <li>横軸：価格（円）／縦軸：レビュー評価</li>
                             <li>円の大きさ：人気（レビュー件数）</li>
                             <li>右上かつ円が大きいほど「高評価×人気」</li>
                         </ul>
                     </div>
                     <p class="mt-4 text-xs text-muted">データ更新: <span id="data-updated"></span>｜出典: 楽天市場ランキング｜算出: 価格・評価・人気の総合</p>
                 </div>
            </details>
        </section>

        <!-- 選び方ガイド -->
        <section id="selection-guide" class="mb-10 md:mb-14">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">0歳から5歳くらいまでの子育て中で、毎日時間に追われているママ。家事や育児だけでなく、仕事をしているママもいる。スマホの通知に気づきにくい、スケジュール管理が大変、睡眠不足、自分の時間がなかなか取れないなどの悩みを抱えている。のための商品選びガイド</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div id="guide-popular" role="button" tabindex="0" aria-label="人気重視で並べ替える" class="bg-white p-6 rounded-xl card-shadow cursor-pointer hover:shadow-lg focus:outline-none focus:ring-2 ring-primary">
                        <h3 class="font-bold text-primary mb-3">👑 人気重視派</h3>
                        <p class="text-sm text-gray-600 mb-2"><strong>おすすめ</strong><br>人気モデルでハズレなし！</p>
                        <p class="text-sm text-gray-600">口コミ評価が高く、多くのママから支持されている人気モデル。機能性と使いやすさが両立している傾向。初めてのスマートウォッチにもおすすめ。</p>
                    </div>
                    <div id="guide-cost" role="button" tabindex="0" aria-label="コスパ重視で並べ替える" class="bg-white p-6 rounded-xl card-shadow cursor-pointer hover:shadow-lg focus:outline-none focus:ring-2 ring-primary">
                        <h3 class="font-bold text-primary mb-3">💰 コスパ重視派</h3>
                        <p class="text-sm text-gray-600 mb-2"><strong>おすすめ</strong><br>コスパ重視ならコレ！</p>
                        <p class="text-sm text-gray-600">価格が手頃でも、必要な機能がしっかり搭載されているモデル。予算を抑えたいママにおすすめ。</p>
                    </div>
                    <div id="guide-quality" role="button" tabindex="0" aria-label="品質重視で並べ替える" class="bg-white p-6 rounded-xl card-shadow cursor-pointer hover:shadow-lg focus:outline-none focus:ring-2 ring-primary">
                        <h3 class="font-bold text-primary mb-3">⭐ 品質重視派</h3>
                        <p class="text-sm text-gray-600 mb-2"><strong>おすすめ</strong><br>ワンランク上の機能性！</p>
                        <p class="text-sm text-gray-600">高機能でデザイン性にも優れたモデル。健康管理やワークアウトをしっかりしたいママにぴったり。</p>
                    </div>
                </div>
                <p class="text-center text-xs text-muted mt-3">ヒント：各カードをタップすると一覧に反映されます</p>
            </div>
        </section>

        <section id="interactive-selection" class="mb-16 md:mb-24">
            <div class="max-w-3xl mx-auto text-center mb-10">
                <h2 class="text-2xl md:text-3xl font-bold mb-4">あなたの価値観で選ぶ：商品一覧</h2>
                <p class="text-lg md:text-xl leading-relaxed mb-8 text-gray-700">
                    目的に合わせて並び替えできます。<br class="hidden md:block">「迷ったら人気順」「安く賢くは価格順」「長く使うなら評価順」。
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4 flex-wrap items-center" role="tablist" aria-label="並び替え">
                    <button id="btn-sort-rank" role="tab" aria-selected="true" class="w-full sm:w-auto bg-primary text-white font-bold py-3 px-8 rounded-full transition-all transform-gpu hover:scale-105 card-shadow-hover ring-2 ring-offset-2 ring-primary">👑 人気ランキング順</button>
                    <button id="btn-sort-price" role="tab" aria-selected="false" class="w-full sm:w-auto bg-accent text-white font-bold py-3 px-8 rounded-full transition-all transform-gpu hover:scale-105 card-shadow-hover">💰 価格が安い順</button>
                    <button id="btn-sort-review" role="tab" aria-selected="false" class="w-full sm:w-auto bg-accent text-white font-bold py-3 px-8 rounded-full transition-all transform-gpu hover:scale-105 card-shadow-hover">⭐ 評価が高い順</button>
                    <button id="btn-reset-2" class="w-full sm:w-auto btn btn-outline-primary font-bold py-3 px-6 rounded-full transition-all transform-gpu hover:scale-105 card-shadow-hover">リセット</button>
                </div>
            </div>
            <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10"></div>
        </section>

        <!-- FAQセクション -->
        <section id="faq" class="max-w-4xl mx-auto mb-16 md:mb-20">
            <h2 class="text-2xl md:text-3xl font-bold text-center mb-4">よくある質問（FAQ）</h2>
            <div class="flex justify-center gap-2 mb-6">
                <button id="btn-faq-open-all" class="btn border px-4 py-3 rounded-lg text-sm">すべて開く</button>
                <button id="btn-faq-close-all" class="btn border px-4 py-3 rounded-lg text-sm">すべて閉じる</button>
            </div>
            <div class="space-y-4">
                
                  
                  <details class="bg-white rounded-xl card-shadow">
                    <summary class="list-none cursor-pointer p-4 md:p-6 flex items-center justify-between">
                        <span class="font-semibold text-primary">スマートウォッチを使うメリットは？</span>
                        <span class="text-2xl text-muted" aria-hidden="true">＋</span>
                    </summary>
                    <div class="px-4 md:px-6 pb-4 md:pb-6 text-gray-700 leading-relaxed text-base">
                        <p>スマホを頻繁に見なくても通知が確認できる、スケジュール管理ができる、活動量や睡眠の質を記録できるなど、多くのメリットがあります。育児や仕事で忙しいママの時間管理をサポートし、日々の生活をスムーズにしてくれます。</p>
                    </div>
                  </details>
                  
                  <details class="bg-white rounded-xl card-shadow">
                    <summary class="list-none cursor-pointer p-4 md:p-6 flex items-center justify-between">
                        <span class="font-semibold text-primary">防水機能は必要？</span>
                        <span class="text-2xl text-muted" aria-hidden="true">＋</span>
                    </summary>
                    <div class="px-4 md:px-6 pb-4 md:pb-6 text-gray-700 leading-relaxed text-base">
                        <p>水仕事が多いママには防水機能がついたスマートウォッチがおすすめ。手洗いや洗い物、水遊びなどでも気にせず使えます。防水機能のレベルにも注意して選びましょう。</p>
                    </div>
                  </details>
                  
                  <details class="bg-white rounded-xl card-shadow">
                    <summary class="list-none cursor-pointer p-4 md:p-6 flex items-center justify-between">
                        <span class="font-semibold text-primary">バッテリーの持ちはどれくらい？</span>
                        <span class="text-2xl text-muted" aria-hidden="true">＋</span>
                    </summary>
                    <div class="px-4 md:px-6 pb-4 md:pb-6 text-gray-700 leading-relaxed text-base">
                        <p>モデルによってバッテリーの持ち時間はさまざま。数日間充電なしで使えるものから、毎日充電が必要なものまであります。自分の使用頻度に合わせて選びましょう。</p>
                    </div>
                  </details>
                  
                  <details class="bg-white rounded-xl card-shadow">
                    <summary class="list-none cursor-pointer p-4 md:p-6 flex items-center justify-between">
                        <span class="font-semibold text-primary">どんな機能があれば便利？</span>
                        <span class="text-2xl text-muted" aria-hidden="true">＋</span>
                    </summary>
                    <div class="px-4 md:px-6 pb-4 md:pb-6 text-gray-700 leading-relaxed text-base">
                        <p>スマホの通知確認、スケジュール管理、睡眠トラッキング、心拍計、GPSなどは特に便利な機能です。自分のライフスタイルや目的に合わせて必要な機能を選びましょう。</p>
                    </div>
                  </details>
                  
                  <details class="bg-white rounded-xl card-shadow">
                    <summary class="list-none cursor-pointer p-4 md:p-6 flex items-center justify-between">
                        <span class="font-semibold text-primary">子供がいると壊してしまう心配は？</span>
                        <span class="text-2xl text-muted" aria-hidden="true">＋</span>
                    </summary>
                    <div class="px-4 md:px-6 pb-4 md:pb-6 text-gray-700 leading-relaxed text-base">
                        <p>耐久性の高いモデルを選ぶのがおすすめ。子供に触られても壊れにくい、傷つきにくい素材を選びましょう。また、ベルトが簡単に交換できるかもチェックしておくと安心です。</p>
                    </div>
                  </details>
                  
                
            </div>
        </section>

        <!-- まとめセクション -->
        <section id="conclusion" class="max-w-3xl mx-auto text-center mt-12">
            <h2 class="text-2xl md:text-3xl font-bold mb-4">まとめ</h2>
            <div id="recommendation-text" class="bg-white p-6 md:p-8 rounded-2xl card-shadow text-left leading-relaxed">
                <p class="font-bold text-lg mb-3 text-center">自分にぴったりのスマートウォッチで快適な毎日を！</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-bold text-green-800 mb-2">メリット</h4>
                        <ul class="text-sm space-y-1 text-green-700">
                            <li>• 機能性とデザインを両立</li>
                            <li>• 1,000～2,000円台中心でコスパ良好</li>
                            <li>• 子育て中でも扱いやすい</li>
                            <li>• 長く使える耐久性と着心地</li>
                        </ul>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg">
                        <h4 class="font-bold text-orange-800 mb-2">注意点</h4>
                        <ul class="text-sm space-y-1 text-orange-700">
                            <li>• サイズ感はレビューで要確認</li>
                            <li>• 価格・在庫は変動（リンク先で最新確認）</li>
                            <li>• 人気色は早期完売しがち</li>
                        </ul>
                    </div>
                </div>
                <p class="text-center text-gray-600">スマートウォッチは育児中のママの生活をサポートしてくれる便利なアイテム。この記事を参考に、自分にぴったりのスマートウォッチを見つけて、少しでも毎日を快適に過ごしましょう。</p>
            </div>
        </section>

        <!-- ユーザーの声 -->
        <section id="testimonials" class="max-w-4xl mx-auto mt-10 md:mt-14 mb-16 md:mb-20">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">先輩ユーザーの声</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <blockquote class="testimonial bg-white p-5 rounded-xl card-shadow text-sm leading-relaxed cursor-pointer" data-query="UV 体型カバー" data-tags="UVカット 体型カバー">
                        <p class="mb-2">「公園や送迎で重宝。紫外線対策と体型カバーが両立できました。」</p>
                        <footer class="text-xs text-muted">30代・2児のママ</footer>
                    </blockquote>
                    <blockquote class="testimonial bg-white p-5 rounded-xl card-shadow text-sm leading-relaxed cursor-pointer" data-query="ルームウェア 洗濯 安い" data-tags="ルームウェア">
                        <p class="mb-2">「1,000円台で十分。洗濯に強くて毎日ヘビロテしています。」</p>
                        <footer class="text-xs text-muted">40代・小学生ママ</footer>
                    </blockquote>
                    <blockquote class="testimonial bg-white p-5 rounded-xl card-shadow text-sm leading-relaxed cursor-pointer" data-query="サイズ 伸縮 パンツ" data-tags="パンツ デニム">
                        <p class="mb-2">「サイズ展開が豊富で安心。レビュー通りの着心地で満足。」</p>
                        <footer class="text-xs text-muted">20代・ワーママ</footer>
                    </blockquote>
                </div>
                <p class="text-center text-xs text-muted mt-3">ヒント：タップで関連条件の一覧にジャンプします</p>
            </div>
        </section>

        <!-- シェア（記事末尾） -->
        <section id="share-bottom" class="max-w-4xl mx-auto mt-10 md:mt-14" aria-label="この記事を共有（記事末尾）">
            <div class="bg-white dark:bg-opacity-80 backdrop-blur-sm p-3 sm:p-4 rounded-2xl card-shadow">
                <div class="share-bar" role="group" aria-label="共有ボタン">
                    <button type="button" class="btn share-chip text-sm" data-share-action="native" aria-label="OSの共有シートを開く"><span class="icon-bg">⬆️</span>OSで共有</button>
                    <button type="button" class="btn share-chip text-sm" data-share-action="x" aria-label="Xでシェア"><span class="icon-bg">𝕏</span>Xでシェア</button>
                    <button type="button" class="btn share-chip text-sm" data-share-action="line" aria-label="LINEで送る"><span class="icon-bg">LINE</span>LINEで送る</button>
                    <button type="button" class="btn share-chip text-sm" data-share-action="copy" aria-label="リンクをコピー"><span class="icon-bg">⧉</span>リンクをコピー</button>
                </div>
            </div>
        </section>

        <div id="compare-bar" class="sticky-bar max-w-4xl mx-auto mt-6 hidden"></div>
    </div>

    <!-- トップへ戻るボタン -->
    <button id="btn-back-to-top" class="floating btn-cta text-white px-4 py-3 rounded-full card-shadow-hover" aria-label="ページ上部へ戻る" style="display:none;">↑ トップ</button>

    <!-- 
      初期表示用の商品データをJSONとして直接埋め込みます。
      これにより、外部JS/JSONの読み込みを待たずにUIの初期描画が完了します。
      Jinja2の `tojson` フィルタと `safe` フィルタを使い、安全にJSON文字列を出力します。
    -->
    <script>
      let productsData = [{"affiliateUrl": "https://hb.afl.rakuten.co.jp/hgc/g00pxi4k.qgo2x8a3.g00pxi4k.qgo2y60d/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frikaryo%2Fb-ashiya-k-shorts16-2%2F\u0026m=http%3A%2F%2Fm.rakuten.co.jp%2Frikaryo%2Fi%2F10008883%2F\u0026rafcid=wsc_i_is_1014243036473883403", "catchcopy": "\u7523\u5f8c\u30b1\u30a2\u3092\u9811\u5f35\u308b\u30de\u30de\u306b\uff01\u9aa8\u76e4\u30b1\u30a2\u3067\u30b9\u30bf\u30a4\u30eb\u30a2\u30c3\u30d7\u3092\u76ee\u6307\u305b\u308b\u30b7\u30e7\u30fc\u30c4\u3002", "description": "\u4f38\u7e2e\u6027\u306e\u3042\u308b\u7d20\u6750\u3067\u9aa8\u76e4\u307e\u308f\u308a\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3001\u7f8e\u3057\u3044\u30b7\u30eb\u30a8\u30c3\u30c8\u3092\u76ee\u6307\u305b\u307e\u3059\u3002\u7dbf\u6df7\u7d20\u6750\u3067\u808c\u89e6\u308a\u3082\u826f\u304f\u3001\u5b63\u7bc0\u3092\u554f\u308f\u305a\u7740\u7528\u3067\u304d\u307e\u3059\u3002\u7523\u5f8c\u306e\u4f53\u578b\u5909\u5316\u306b\u60a9\u3080\u30de\u30de\u306b\u3001\u30b9\u30bf\u30a4\u30eb\u30a2\u30c3\u30d7\u306e\u30b5\u30dd\u30fc\u30c8\u3068\u3057\u3066\u304a\u3059\u3059\u3081\u3067\u3059\u3002\u7d046,800\u5186\u3067\u3001\u30ec\u30d3\u30e5\u30fc\u8a55\u4fa1\u306f4.19\u3001\u30ec\u30d3\u30e5\u30fc\u6570\u306f449\u4ef6\u3067\u3059(2023\u5e7411\u6708\u6642\u70b9)\u3002", "imageUrl": "https://thumbnail.image.rakuten.co.jp/@0_mall/rikaryo/cabinet/cmgd/ecwr/ashiya-ma-shorts2-m1.jpg?_ex=128x128", "itemCaption": "ITEM INFORMATION - \u30a2\u30a4\u30c6\u30e0\u30a4\u30f3\u30d5\u30a9\u30e1\u30fc\u30b7\u30e7\u30f3 \u5546\u54c1\u540d \u226a2\u679a\u7d44\u226b\u82a6\u5c4b\u7f8e\u6574\u4f53 \u7dbf\u6df7\u3042\u3063\u305f\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 \u6750\u8cea \u30dd\u30ea\u30a8\u30b9\u30c6\u30eb\u30fb\u30dd\u30ea\u30a6\u30ec\u30bf\u30f3\u30fb\u30ca\u30a4\u30ed\u30f3\u30fb\u7dbf \u30ab\u30e9\u30fc \u30ed\u30bc\u30d9\u30fc\u30b8\u30e5\u3001\u30d6\u30e9\u30c3\u30af \u9069\u5fdc\u30b5\u30a4\u30ba S\u30b5\u30a4\u30ba\uff1a\u30a6\u30a8\u30b9\u30c8 58\u301c64cm / \u30d2\u30c3\u30d7 82\u301c90cm M\u30b5\u30a4\u30ba\uff1a\u30a6\u30a8\u30b9\u30c8 64\u301c70cm / \u30d2\u30c3\u30d7 88\u301c94cm L\u30b5\u30a4\u30ba\uff1a\u30a6\u30a8\u30b9\u30c8 70\u301c77cm / \u30d2\u30c3\u30d7 94\u301c100cm LL\u30b5\u30a4\u30ba\uff1a\u30a6\u30a8\u30b9\u30c8 77\u301c86cm / \u30d2\u30c3\u30d7 100\u301c106cm 3L\uff1a\u30a6\u30a8\u30b9\u30c8 85\u301c93cm / \u30d2\u30c3\u30d7 102\u301c110cm 4L\uff1a\u30a6\u30a8\u30b9\u30c8 93\u301c101cm / \u30d2\u30c3\u30d7 107\u301c115cm \u9001\u6599 \u5b85\u914d\u4fbf\u9001\u6599\u7121\u6599\uff08\u5317\u6d77\u9053\u542b\u3080\uff09 \u203b\u6c96\u7e04\u3001\u96e2\u5cf6\u3001\u4e00\u90e8\u5730\u57df\u306f\u5dee\u984d\u9001\u6599\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\u8a73\u3057\u304f\u306f\u304a\u554f\u5408\u305b\u4e0b\u3055\u3044 \u30e1\u30fc\u30eb\u4fbf\u9001\u6599\u7121\u6599\uff08\u6c96\u7e04\u3001\u96e2\u5cf6\u542b\u3080\uff09 \u203b\u30dd\u30b9\u30c8\u6295\u51fd\u306b\u3066\u304a\u5c4a\u3051\u3057\u307e\u3059\u3002 \u203b\u4ee3\u5f15\u304d\u4e0d\u53ef\u3001\u3042\u3059\u697d\u4e0d\u53ef\u3001\u88dc\u511f\u306f\u5fa1\u5ea7\u3044\u307e\u305b\u3093\u3002 \u4f7f\u7528\u4e0a\u306e\u3054\u6ce8\u610f \u3010\u6d17\u6fef\u65b9\u6cd5\u3011 \u30fb\u67d3\u6599\u306e\u7279\u6027\u4e0a\u3001\u6c57\u3084\u6469\u64e6\u306b\u3088\u3063\u3066\u307e\u308c\u306b\u8272\u843d\u3061\u3084\u8272\u79fb\u308a\u304c\u751f\u3058\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u4ed6\u306e\u3082\u306e\u3068\u5206\u3051\u3066\u6d17\u6fef\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u30fb\u6d78\u3051\u7f6e\u304d\u306f\u304a\u907f\u3051\u304f\u3060\u3055\u3044\u3002 \u30fb\u6d17\u6fef\u6a5f\u4f7f\u7528\u306e\u5834\u5408\u306f\u30cd\u30c3\u30c8\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u30fb\u6d17\u6fef\u5f8c\u306f\u3059\u3050\u306b\u5f62\u3092\u6574\u3048\u3066\u5e72\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u30fb\u7121\u86cd\u5149\u6d17\u5264\u3092\u3054\u4f7f\u7528\u304f\u3060\u3055\u3044\u3002 \u30fb\u30bf\u30f3\u30d6\u30e9\u30fc\u4e7e\u71e5\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u30fb\u30a2\u30a4\u30ed\u30f3\u304c\u3051\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u3054\u6ce8\u610f \u30fb\u30c6\u30ec\u30d3\u756a\u7d44\u306e\u5185\u5bb9\u306b\u3088\u308a\u300c\u9aa8\u76e4\u30b7\u30e7\u30fc\u30c4\u300d\u300c\u9aa8\u76e4\u30b9\u30c3\u30ad\u30ea\u30b7\u30e7\u30fc\u30c4\u300d\u300c\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4\u300d\u3068\u540d\u79f0\u304c\u5909\u66f4\u3055\u308c\u3066\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u304c\u3054\u3056\u3044\u307e\u3059\u304c\u5168\u3066\u540c\u4e00\u5546\u54c1\u3067\u3059\u3002\u5f53\u5e97\u3067\u53d6\u308a\u6271\u3044\u4e2d\u306e\u300c\u82a6\u5c4b\u7f8e\u6574\u4f53 \u3042\u3063\u305f\u304b\u88cf\u8d77\u6bdb \u7dbf\u6df7\u3084\u308f\u3089\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4\u300d\u306f\u5168\u3066\u6b63\u898f\u54c1\u3067\u3059\u3002\u3053\u3061\u3089\u306f\u88cf\u8d77\u6bdb\u4ed8\u304d\u3067 \u3075\u3093\u308f\u308a\u3084\u308f\u3089\u304b\u3042\u3063\u305f\u304b \u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 \u3068\u306f\u4e00\u90e8\u4ed5\u69d8\u304c\u7570\u306a\u308a\u307e\u3059 \u30fb\u6d88\u8017\u54c1\u306e\u70ba\u3001\u4f7f\u7528\u306e\u983b\u5ea6\u3084\u7740\u7528\u65b9\u6cd5\u306b\u3088\u308a\u7834\u3051\u308b\u3053\u3068\u304c\u3054\u3056\u3044\u307e\u3059\u3002 \u30fb\u885b\u751f\u4e0a\u306e\u554f\u984c\u306e\u305f\u3081\u3001\u958b\u5c01\u30fb\u7740\u7528\u5f8c\u306e\u8fd4\u54c1\u30fb\u4ea4\u63db\u306f\u304a\u53d7\u3051\u3067\u304d\u307e\u305b\u3093\u3002 \u5546\u54c1\u306e\u5909\u66f4\u5185\u5bb9 \u30fb\u3053\u3061\u3089\u306e\u5546\u54c1\u306f2020\u5e7410\u670815\u65e5\u306b\u30ea\u30cb\u30e5\u30fc\u30a2\u30eb(\u30de\u30a4\u30ca\u30fc\u30c1\u30a7\u30f3\u30b8)\u3055\u308c\u307e\u3057\u305f\u3002 \u30fb\u30c7\u30b6\u30a4\u30f3\u304c\u5909\u66f4\u306b\u306a\u308a\u7dbf\u6df7\u7d20\u6750\u3067\u808c\u306b\u3084\u3055\u3057\u304f\u306a\u308a\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u88cf\u8d77\u6bdb\u3067\u3042\u305f\u305f\u304b\u3055\u3092\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002 \u88fd\u9020\u56fd \u4e2d\u56fd [KEYWORD] \u82a6\u5c4b\u7f8e\u6574\u4f53 \u3042\u3063\u305f\u304b\u88cf\u8d77\u6bdb \u7dbf\u6df7\u3084\u308f\u3089\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 2\u679a\u7d44 2020\u5e74\u65b0\u4f5c \u3042\u3063\u305f\u304b\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 \u7dbf\u6df7 \u88cf\u8d77\u6bdb \u3042\u3063\u305f\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 \u82a6\u5c4b\u7f8e\u6574\u4f53\u3042\u3063\u305f\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 2\u679a\u7d44 \u9aa8\u76e4\u30b9\u30c3\u30ad\u30ea\u30b7\u30e7\u30fc\u30c4 HOT \u3000 \u82a6\u5c4b\u7f8e\u6574\u4f53\u30b7\u30ea\u30fc\u30baTV\u901a\u8ca9\u597d\u8a55\u8ca9\u58f2\u4e2d\u3067\u3059 \u25a0\u3053\u306e\u5546\u54c1\u306e\u95a2\u9023\u5546\u54c1\u306f\u3053\u3061\u30892020\u5e74\u65b0\u4f5c\u300e\u82a6\u5c4b\u7f8e\u6574\u4f53 \u7dbf\u6df7\u3042\u3063\u305f\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4\u300f \u4eba\u6c17\u9aa8\u76e4\u77ef\u6b63\u30b5\u30ed\u30f3\u30fb\u82a6\u5c4b\u7f8e\u6574\u4f53\u306e\u7d0d\u5bcc\u4e9c\u77e2\u5b50\u5148\u751f\u76e3\u4fee\u3002 \u51ac\u7528\u306e\u3042\u3063\u305f\u304b\u30b7\u30e7\u30fc\u30c4\u306b2020\u5e74\u30cb\u30e5\u30fc\u30e2\u30c7\u30eb\u304c\u767b\u5834\u3044\u305f\u3057\u307e\u3057\u305f\u3002 \u25a0Point1\u300c\u88cf\u8d77\u6bdb\uff06\u5929\u7136\u706b\u5c71\u5ca9\u7e4a\u7dad\u3092\u63a1\u7528\u300d \u84c4\u71b1\u6027\u3001\u4fdd\u6e29\u6027\u304c\u629c\u7fa4\uff01\uff01 \u25a0Point2\u300c\u304a\u8179\u306b\u3042\u305f\u308b\u90e8\u5206\u306f\u7dbf\u6df7\u306b\u300d \u3084\u3055\u3057\u3044\u306f\u304d\u5fc3\u5730\u3067\u30d5\u30a3\u30c3\u30c8\u3002 \u25a0Point3\u300c\u3057\u3063\u304b\u308a\u4f38\u3073\u3066\u82e6\u3057\u304f\u306a\u3044\u300d \u30a6\u30a8\u30b9\u30c8\u90e8\u5206\u306e\u4f38\u7e2e\u6027\u306f\u629c\u7fa4\uff01 \u25a0\u51ac\u306b\u5b09\u3057\u3044\u3042\u3063\u305f\u304b\u4ed5\u69d8\u306e\u30b7\u30e7\u30fc\u30c4\uff01 \u3042\u3063\u305f\u304b\u306e\u79d8\u5bc6\u306f\u300c\u5929\u7136\u706b\u5c71\u5ca9\u7e4a\u7dad\u300d \u4f53\u304b\u3089\u6392\u51fa\u3055\u308c\u308b\u9060\u8d64\u5916\u7dda\u3092\u3001\u30ca\u30ce\u5316\u3057\u305f\u5929\u7136\u706b\u5c71\u5ca9\uff08\u91d1\u5c5e\uff09\u3092\u306d\u308a\u3053\u3093\u3060\u7e4a\u7dad\u304c\u53cd\u5c04\u3055\u305b\u3066\u5916\u306b\u9003\u3055\u306a\u3044\u3002 \u25a0\u30ab\u30b7\u30df\u30a2\u3088\u308a\u6e29\u304b\u3044\u30b7\u30e7\u30fc\u30c4\u304c\u8a95\u751f\u3057\u307e\u3057\u305f\uff01 \u3042\u3063\u305f\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4\u306f\u3086\u304c\u307f\u3068\u3068\u3082\u306b\u51b7\u3048\u304b\u3089\u3082\u5927\u5207\u306a\u9aa8\u76e4\u3092\u5b88\u308a\u307e\u3059\u3002 \u51b7\u3048\u306f\u5973\u6027\u306e\u5927\u6575\u3002 \u51b7\u3048\u304c\u5e38\u7fd2\u5316\u3059\u308b\u3068\u57fa\u790e\u4ee3\u8b1d\u306e\u60aa\u5316\u3092\u62db\u304d\u4f53\u5168\u4f53\u306e\u4e0d\u8abf\u3078\u3068\u3064\u306a\u304c\u308b\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u3059\u3002 \u307e\u305f\u9aa8\u76e4\u307e\u308f\u308a\u304c\u51b7\u3048\u308b\u3068\u8eab\u4f53\u306f\u5927\u5207\u306a\u5b50\u5bae\u3092\u5b88\u308d\u3046\u3068\u3059\u308b\u305f\u3081\u306b\u4e0b\u8179\u90e8\u306b\u8102\u80aa\u3092\u84c4\u3048\u3066\u3057\u307e\u3046\u3068\u8003\u3048\u3089\u308c\u3066\u3044\u307e\u3059\u3002 \u51ac\u306f\u9aa8\u76e4\u5468\u308a\u3092\u51b7\u3084\u3055\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\uff01", "itemCode": "rikaryo:10008883", "itemName": "\u82a6\u5c4b\u7f8e\u6574\u4f53 \u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 2\u679a\u7d44 \u3010HOT\u3011\u2605\u5f8c\u6255\u3044\u53ef\uff01\u2606\u9078\u3079\u308b\u304a\u307e\u3051\u2605 \u82a6\u5c4b\u7f8e\u6574\u4f53 \u7dbf\u6df7\u3042\u3063\u305f\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 \u9001\u6599\u7121\u6599 2020 \u3075\u3093\u308f\u308a \u3042\u3063\u305f\u304b\u88cf\u8d77\u6bdb \u3042\u3063\u305f\u304b\u9aa8\u76e4\u30b9\u30ea\u30e0\u30b7\u30e7\u30fc\u30c4 \u7dbf\u6df7\u3084\u308f\u3089\u304b \u88cf\u8d77\u6bdb \u9aa8\u76e4\u30b9\u30c3\u30ad\u30ea\u30b7\u30e7\u30fc\u30c4 \u9aa8\u76e4\u30b7\u30e7\u30fc\u30c4 HOT nkp", "itemPrice": 6800, "pointRate": 10, "rank": null, "reviewAverage": 4.19, "reviewCount": 449, "score": 0.5, "shopName": "\u308a\u304b\u306e\u826f\u54c1", "shopUrl": "https://hb.afl.rakuten.co.jp/hgc/g00pxi4k.qgo2x8a3.g00pxi4k.qgo2y60d/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Frikaryo%2F\u0026m=http%3A%2F%2Fm.rakuten.co.jp%2Frikaryo%2F\u0026rafcid=wsc_i_is_1014243036473883403"}];
    </script>

    <!--
      動的なUI制御を行うためのメインスクリプトです。
      サンプルHTMLからスクリプト部分をここに移植・統合しました。
      外部ファイル化も可能ですが、記事ごとにロジックが若干変わる可能性を考慮し、
      テンプレート内に直接埋め込む構成にしています。
    -->
    <script>
      // app.js を埋め込み
      document.addEventListener('DOMContentLoaded', () => {

    // --- グローバル変数 productsData が存在するかチェック ---
    if (typeof productsData === 'undefined' || !Array.isArray(productsData)) {
        console.error('商品データ (productsData) が見つからないか、形式が不正です。');
        return;
    }

    const resultsContainer = document.getElementById('results-container');
    const sortButtons = {
        rank: document.getElementById('btn-sort-rank'),
        price: document.getElementById('btn-sort-price'),
        review: document.getElementById('btn-sort-review'),
        score: document.getElementById('btn-sort-score'),
    };
    
    // --- UI要素の取得 ---
    const searchBox = document.getElementById('search-box');
    const priceMinInput = document.getElementById('price-min');
    const priceMaxInput = document.getElementById('price-max');
    const priceRangeQuick = document.getElementById('price-range');
    const filterRating = document.getElementById('filter-rating');
    const filterReview = document.getElementById('filter-review');
    const labelRating = document.getElementById('label-rating');
    const labelReview = document.getElementById('label-review');
    const favOnlyCheckbox = document.getElementById('filter-fav');
    const btnReset = document.getElementById('btn-reset');
    const btnReset2 = document.getElementById('btn-reset-2');
    const tagsContainer = document.getElementById('tags-container');
    const resultSummary = document.getElementById('result-summary');
    const compareBar = document.getElementById('compare-bar');
    const compareCount = document.getElementById('compare-count');
    const btnCompare = document.getElementById('btn-compare');
    const btnCompareClear = document.getElementById('btn-compare-clear');
    const btnDarkToggle = document.getElementById('btn-dark-toggle');
    const btnInstall = document.getElementById('btn-install');
    const top3Container = document.getElementById('top3-container');
    const chartCanvas = document.getElementById('productsChart');


    // --- 状態管理 ---
    let state = {
        products: [...productsData],
        filteredProducts: [...productsData],
        sortBy: 'rank',
        filters: {
            keyword: '',
            priceMin: null,
            priceMax: null,
            rating: 0,
            reviews: 0,
            tags: new Set(),
            favOnly: false,
        },
        favorites: getFavorites(),
        compareItems: new Set(),
        isDarkMode: localStorage.getItem('theme') === 'dark',
        priceBounds: { min: null, max: null },
    };

    // --- ユーティリティ関数 ---
    const debounce = (fn, ms = 250) => {
        let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
    };

    function getFavorites() {
        try {
            return new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));
        } catch {
            return new Set();
        }
    }
    
    function saveFavorites(favs) {
        localStorage.setItem('favorites', JSON.stringify(Array.from(favs)));
    }

    // --- 表示フォーマット/画像ヘルパー ---
    // 簡易トラッキング（GA4想定 or dataLayerフォールバック）
    window.dataLayer = window.dataLayer || [];
    function track(eventName, params = {}) {
        try {
            if (window.gtag) { window.gtag('event', eventName, params); }
            else { window.dataLayer.push({ event: eventName, ...params }); }
        } catch {}
    }
    function getId(p) {
        try {
            return p.itemCode || `name:${String(p.itemName || '')}`;
        } catch { return `name:${Math.random().toString(36).slice(2)}`; }
    }
    function inferTags(p) {
        try {
            const name = `${p.itemName || ''} ${p.catchcopy || ''} ${p.description || ''}`.toLowerCase();
            const tags = new Set();
            if (name.includes('uv')) tags.add('UVカット');
            if (name.includes('冷感') || name.includes('ひんやり')) tags.add('冷感');
            if (name.includes('ワンピ') || name.includes('onepiece')) tags.add('ワンピース');
            if (name.includes('水着') || name.includes('ラッシュ')) tags.add('水着');
            if (name.includes('パンツ')) tags.add('パンツ');
            if (name.includes('デニム')) tags.add('デニム');
            if (name.includes('ルームウェア')) tags.add('ルームウェア');
            if (name.includes('体型カバー')) tags.add('体型カバー');
            if (name.includes('パーカー')) tags.add('パーカー');
            return Array.from(tags);
        } catch { return p.tags || []; }
    }
    function augmentProducts(list) {
        try {
            return list.map(p => ({ ...p, tags: Array.isArray(p.tags) ? p.tags : inferTags(p) }));
        } catch { return list; }
    }
    function computePriceBounds(list) {
        try {
            const prices = list.map(p => Number(p.itemPrice || 0)).filter(Number.isFinite);
            if (!prices.length) return { min: 0, max: 0 };
            return { min: Math.min(...prices), max: Math.max(...prices) };
        } catch { return { min: 0, max: 0 }; }
    }
    function formatRating(v) { try { return Number(v ?? 0).toFixed(2); } catch { return '0.00'; } }
    function formatPrice(v) { try { return `¥${Number(v ?? 0).toLocaleString()}`; } catch { return '¥0'; } }
    function imgUrlWithSize(url, size) {
        try {
            if (!url) return url;
            const hasQuery = url.includes('?');
            const exParam = `_ex=${size}x${size}`;
            if (/_ex=\d+x\d+/.test(url)) return url.replace(/_ex=\d+x\d+/, exParam);
            return url + (hasQuery ? '&' : '?') + exParam;
        } catch { return url; }
    }
    function buildSrcset(url) {
        const sizes = [320, 480, 640, 800, 1200];
        return sizes.map(s => `${imgUrlWithSize(url, s)} ${s}w`).join(', ');
    }

    // --- Chart.js ローダー/描画 ---
    let productsChart = null;
    let currentData = [];
    function loadScript(src) {
        return new Promise((resolve, reject) => {
            const s = document.createElement('script');
            s.src = src; s.async = true; s.onload = resolve; s.onerror = reject;
            document.head.appendChild(s);
        });
    }
    async function ensureChart() {
        if (window.Chart) return true;
        try {
            await loadScript('https://cdn.jsdelivr.net/npm/chart.js');
            await loadScript('https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js');
            return true;
        } catch {
            return false;
        }
    }
    function refreshChart(list) {
        const canvas = document.getElementById('productsChart');
        if (!canvas || !Array.isArray(list) || list.length === 0 || !window.Chart) return;
        const ctx = canvas.getContext('2d');
        const dataPoints = list.map((p, i) => ({
            x: p.itemPrice,
            y: Number(p.reviewAverage),
            r: Math.max(5, Math.sqrt(p.reviewCount || 0) / 10),
            label: `[${i + 1}位] ${p.itemName}`,
            id: getId(p),
        }));
        const ys = dataPoints.map(d => d.y);
        const yMin = Math.max(0, Math.min(...ys) - 0.05);
        const yMax = Math.min(5, Math.max(...ys) + 0.05);
        if (!productsChart) {
            productsChart = new Chart(ctx, {
                type: 'bubble',
                data: { datasets: [{ label: '商品', data: dataPoints, backgroundColor: 'rgba(37, 99, 235, 0.6)', borderColor: 'rgba(37, 99, 235, 1)', borderWidth: 1 }] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: (c) => [ `${c.raw.label}`, `価格: ${c.raw.x.toLocaleString()}円`, `評価: ${Number(c.raw.y).toFixed(2)}` ] } }
                    },
                    onClick: (_, elements) => {
                        try {
                            if (!elements || !elements.length) return;
                            const idx = elements[0].index;
                            const el = document.getElementById(`card-${idx + 1}`);
                            if (el) {
                                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                el.classList.add('highlight-ring');
                                setTimeout(() => el.classList.remove('highlight-ring'), 1600);
                                track('chart_point_click', { index: idx + 1 });
                            }
                        } catch {}
                    },
                    scales: {
                        x: { title: { display: true, text: '価格（円）' }, ticks: { callback: (v) => Number(v).toLocaleString() } },
                        y: { title: { display: true, text: 'レビュー評価' }, min: yMin, max: yMax },
                    }
                }
            });
        } else {
            productsChart.data.datasets[0].data = dataPoints;
            productsChart.options.scales.y.min = yMin;
            productsChart.options.scales.y.max = yMax;
            productsChart.update();
        }
    }

    // --- レンダリング関数 ---
    function renderProducts(productsToRender) {
        if (!resultsContainer) return;
        resultsContainer.innerHTML = productsToRender.map((p, idx) => createProductCard({ ...p, _displayRank: (idx + 1) })).join('');
        resultSummary.textContent = `${productsToRender.length}件表示中`;
        // フェードイン（不可視クラスの除去）
        try {
            requestAnimationFrame(() => {
                document.querySelectorAll('#results-container .opacity-0').forEach(el => {
                    el.classList.remove('opacity-0');
                    el.classList.remove('translate-y-4');
                });
            });
        } catch {}
        // アフィリエイトクリックのトラッキング（委譲）
        try {
            resultsContainer.querySelectorAll('a.aff-link').forEach(a => {
                a.addEventListener('click', () => {
                    const rank = a.getAttribute('data-rank');
                    const name = a.getAttribute('data-name');
                    const price = Number(a.getAttribute('data-price') || 0);
                    track('aff_click', { rank, name, price });
                }, { once: true });
            });
        } catch {}
    }

    function createProductCard(p) {
        const id = getId(p);
        const isFav = state.favorites.has(id);
        const isCompared = state.compareItems.has(id);
        const img640 = imgUrlWithSize(p.imageUrl, 640);
        const srcset = buildSrcset(p.imageUrl || '');
        return `
          <div id="card-${p._displayRank || p.rank || 0}" class="bg-white rounded-2xl card-shadow card-shadow-hover transition-all transform-gpu opacity-0 translate-y-4" style="transition-delay: ${(p._displayRank || p.rank || 0) * 40}ms;" data-id="${id}">
            <img src="${img640}" srcset="${srcset}" sizes="(min-width:1024px) 320px, (min-width:768px) 45vw, 90vw" alt="${p.itemName}" width="640" height="640" class="rounded-t-2xl w-full object-contain bg-white" style="aspect-ratio: 1 / 1;" loading="lazy" decoding="async">
            <div class="p-5 md:p-6">
              <div class="flex justify-between items-start mb-3">
                <div class="pr-2">
                  <p class="text-xs text-gray-500">RANK ${p._displayRank || p.rank || '-'}</p>
                  <h3 class="font-bold text-primary leading-tight line-clamp-2" title="${p.itemName}">${p.itemName}</h3>
                </div>
                <div class="flex items-center gap-2">
                  <button class="btn btn-fav text-yellow-500 text-xl" data-id="${id}" aria-label="お気に入りに追加/解除">${isFav ? '★' : '☆'}</button>
                  <span class="text-xl font-bold text-accent whitespace-nowrap">${formatPrice(p.itemPrice)}</span>
                </div>
              </div>
              <div class="text-base space-y-2 mb-4">
                <p class="text-gray-700 line-clamp-2">${p.catchcopy || p.description || ''}</p>
                <div class="flex items-center gap-4 text-sm">
                  <span class="badge-primary px-2 py-0.5 rounded-full">⭐ ${formatRating(p.reviewAverage)}</span>
                  <span class="text-gray-500">✍️ ${(p.reviewCount || 0).toLocaleString()}件</span>
                  ${p.pointRate && Number(p.pointRate) > 1 ? `<span class="badge-primary px-2 py-0.5 rounded-full">ポイント${p.pointRate}倍</span>` : ''}
                </div>
              </div>
              <div class="flex flex-wrap gap-2 mb-3">
                ${(p.tags || []).slice(0,3).map(t => `<span class="chip">${t}</span>`).join('')}
              </div>
              ${(p.description && String(p.description).trim().length > 0) ? `
              <div id="details-${id}" class="text-base leading-relaxed text-gray-700 bg-stone-50 p-3 rounded-lg hidden mb-4">
                <p>${p.description}</p>
              </div>
              <button class="btn btn-details w-full text-center bg-primary text-white font-bold py-3 rounded-lg hover:brightness-95 transition-colors" data-id="${id}">詳細を見る</button>
              ` : ''}
              <div class="actions-row mt-3">
                <label class="btn-chip"><input type="checkbox" class="compare-checkbox" data-id="${id}" ${isCompared ? 'checked' : ''}><span>比較</span></label>
                <a href="${p.affiliateUrl}" target="_blank" rel="sponsored nofollow noopener noreferrer" class="flex-1 block text-center btn-cta aff-link font-bold py-3 px-4 rounded-lg hover:opacity-95 hover:brightness-110 transition" data-rank="${p._displayRank || p.rank || ''}" data-name="${p.itemName}" data-price="${p.itemPrice}" aria-label="楽天で価格と在庫を確認">楽天で価格・在庫を確認</a>
              </div>
            </div>
          </div>
        `;
    }

    // --- スコア算出（正規化合成） ---
    const WEIGHTS = { price: 0.34, rating: 0.33, reviews: 0.33 };
    function computeScores(list) {
        if (!Array.isArray(list) || list.length === 0) return [];
        const vals = {
            price: list.map(p => Number(p.itemPrice || 0)),
            rating: list.map(p => Number(p.reviewAverage || 0)),
            reviews: list.map(p => Number(p.reviewCount || 0)),
        };
        const mm = (arr) => ({ min: Math.min(...arr), max: Math.max(...arr) });
        const P = mm(vals.price), R = mm(vals.rating), C = mm(vals.reviews);
        const norm = (v, { min, max }, higher) => {
            if (!Number.isFinite(v) || !Number.isFinite(min) || !Number.isFinite(max) || max === min) return 0.5;
            const t = (v - min) / (max - min);
            return higher ? t : 1 - t;
        };
        return list.map(p => {
            const sPrice = norm(Number(p.itemPrice || 0), P, false);
            const sRating = norm(Number(p.reviewAverage || 0), R, true);
            const sReviews = norm(Number(p.reviewCount || 0), C, true);
            const score = sPrice * WEIGHTS.price + sRating * WEIGHTS.rating + sReviews * WEIGHTS.reviews;
            return { ...p, score: Number(score.toFixed(4)) };
        });
    }

    function renderTop3() {
        if (!top3Container) return;
        try {
            const base = (state.products && state.products.length ? state.products : productsData) || [];
            const scored = computeScores(base);
            const top3 = scored.sort((a,b)=> (b.score||0)-(a.score||0)).slice(0,3).map((p, i) => ({ ...p, _displayRank: i+1 }));
            top3Container.innerHTML = top3.map(p => createProductCard(p)).join('');
            requestAnimationFrame(() => {
                document.querySelectorAll('#top3-container .opacity-0').forEach(el => {
                    el.classList.remove('opacity-0');
                    el.classList.remove('translate-y-4');
                });
            });
        } catch {}
    }

    // --- ソートボタンのアクティブ表示更新 ---
    function updateSortButtonsActive(){
        const ids = ['btn-sort-rank','btn-sort-price','btn-sort-review','btn-sort-score'];
        ids.forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            const key = id.replace('btn-sort-','');
            const isActive = state.sortBy === key;
            el.classList.toggle('bg-primary', isActive);
            el.classList.toggle('ring-2', isActive);
            el.classList.toggle('ring-offset-2', isActive);
            el.classList.toggle('ring-primary', isActive);
            el.classList.toggle('bg-accent', !isActive);
            if (el.getAttribute('role') === 'tab') el.setAttribute('aria-selected', String(isActive));
        });
    }

    // --- ガイドカード（人気/コスパ/品質）の強調切替 ---
    function updateGuideActive(which){
        ['popular','cost','quality'].forEach(name => {
            const el = document.getElementById(`guide-${name}`);
            if (!el) return;
            el.classList.toggle('highlight-ring', which === name);
        });
    }

    // --- タグの初期化と操作 ---
    function initTags(){
        if (!tagsContainer) return;
        const tagSet = new Set();
        try {
            state.products.forEach(p => {
                if (Array.isArray(p.tags)) p.tags.forEach(t => tagSet.add(String(t)));
            });
        } catch {}
        const tags = Array.from(tagSet).slice(0, 30);
        tagsContainer.innerHTML = tags.map(t => `<button type="button" class="chip" data-tag="${t}">${t}</button>`).join('');
        tagsContainer.addEventListener('click', (e) => {
            const btn = e.target.closest('button[data-tag]');
            if (!btn) return;
            const t = btn.dataset.tag;
            if (state.filters.tags.has(t)) state.filters.tags.delete(t); else state.filters.tags.add(t);
            btn.classList.toggle('chip-selected', state.filters.tags.has(t));
            applyAll();
        });
    }
    function clearSelectedTags(){
        state.filters.tags.clear();
        if (tagsContainer) tagsContainer.querySelectorAll('button[data-tag]').forEach(el => el.classList.remove('chip-selected'));
    }

    // --- イベントリスナー ---
    function addEventListeners() {
        // ソートボタン
        Object.keys(sortButtons).forEach(key => {
            if (sortButtons[key]) {
                sortButtons[key].addEventListener('click', () => {
                    state.sortBy = key;
                    applyAll();
                    updateSortButtonsActive();
                    track('sort_change', { key });
                });
            }
        });

        // フィルタ
        if(searchBox) searchBox.addEventListener('input', debounce(() => {
            state.filters.keyword = searchBox.value;
            applyAll();
            track('filter_change', { key: 'keyword', value: state.filters.keyword });
        }));
        if (searchBox) searchBox.addEventListener('search', () => { // Safariのクリアボタン対策
            state.filters.keyword = searchBox.value;
            applyAll();
            track('filter_change', { key: 'keyword', value: state.filters.keyword });
        });
        // 価格（最小/最大）
        if (priceMinInput) priceMinInput.addEventListener('input', debounce(() => {
            const v = parseInt(priceMinInput.value, 10);
            state.filters.priceMin = Number.isFinite(v) ? v : null;
            applyAll();
            track('filter_change', { key: 'priceMin', value: state.filters.priceMin });
        }, 200));
        if (priceMaxInput) priceMaxInput.addEventListener('input', debounce(() => {
            const v = parseInt(priceMaxInput.value, 10);
            state.filters.priceMax = Number.isFinite(v) ? v : null;
            applyAll();
            track('filter_change', { key: 'priceMax', value: state.filters.priceMax });
        }, 200));
        // 価格クイックスライダー
        if (priceRangeQuick) priceRangeQuick.addEventListener('input', () => {
            const val = Number(priceRangeQuick.value);
            let min = null, max = null;
            if (val <= 5) { min = null; max = null; }
            else if (val <= 20) { min = 0; max = 2000; }
            else if (val <= 40) { min = 0; max = 3000; }
            else if (val <= 60) { min = 0; max = 5000; }
            else if (val <= 80) { min = 0; max = 8000; }
            else { min = 0; max = 12000; }
            state.filters.priceMin = min; state.filters.priceMax = max;
            if (priceMinInput) priceMinInput.value = min ?? '';
            if (priceMaxInput) priceMaxInput.value = max ?? '';
            applyAll();
            track('filter_change', { key: 'priceQuick', value: { min: state.filters.priceMin, max: state.filters.priceMax } });
        });
        // 評価/レビュー
        if (filterRating) filterRating.addEventListener('input', () => {
            const v = parseFloat(filterRating.value);
            state.filters.rating = Number.isFinite(v) ? v : 0;
            if (labelRating) labelRating.textContent = (state.filters.rating || 0).toFixed(1);
            applyAll();
            track('filter_change', { key: 'rating', value: state.filters.rating });
        });
        if (filterReview) filterReview.addEventListener('input', () => {
            const v = parseInt(filterReview.value, 10) || 0;
            state.filters.reviews = v;
            if (labelReview) labelReview.textContent = String(v);
            applyAll();
            track('filter_change', { key: 'reviews', value: state.filters.reviews });
        });
        // お気に入りのみ
        if (favOnlyCheckbox) favOnlyCheckbox.addEventListener('change', () => {
            state.filters.favOnly = !!favOnlyCheckbox.checked;
            applyAll();
            track('filter_change', { key: 'favOnly', value: state.filters.favOnly });
        });
        // リセット
        const handleReset = () => {
            state.filters = { keyword: '', priceMin: null, priceMax: null, rating: 0, reviews: 0, tags: new Set(), favOnly: false };
            state.sortBy = 'rank';
            if (searchBox) searchBox.value = '';
            if (priceMinInput) priceMinInput.value = '';
            if (priceMaxInput) priceMaxInput.value = '';
            if (priceRangeQuick) priceRangeQuick.value = 0;
            if (filterRating) filterRating.value = 0;
            if (filterReview) filterReview.value = 0;
            if (labelRating) labelRating.textContent = '0.0';
            if (labelReview) labelReview.textContent = '0';
            if (favOnlyCheckbox) favOnlyCheckbox.checked = false;
            clearSelectedTags();
            updateSortButtonsActive();
            updateGuideActive(null);
            applyAll();
            track('reset_filters', {});
        };
        if (btnReset) btnReset.addEventListener('click', handleReset);
        if (btnReset2) btnReset2.addEventListener('click', handleReset);

        // カード内のボタン
        resultsContainer.addEventListener('click', e => {
            const target = e.target.closest('button');
            if (!target) return;
            const id = target.dataset.id;
            if (target.classList.contains('btn-fav') && id) {
                toggleFavorite(id);
                return;
            }
            if (target.classList.contains('btn-compare') && id) {
                toggleCompare(id);
                return;
            }
            if (target.classList.contains('btn-details') && id) {
                const details = document.getElementById(`details-${id}`);
                if (details) {
                    const hidden = details.classList.toggle('hidden');
                    target.textContent = hidden ? '詳細を見る' : '閉じる';
                }
            }
        });
        
        top3Container.addEventListener('click', e => {
            const target = e.target.closest('button.btn-fav');
            if(target) toggleFavorite(target.dataset.itemCode);
        });
        // 比較チェックボックス
        resultsContainer.addEventListener('change', e => {
            const cb = e.target.closest('input.compare-checkbox');
            if (!cb) return;
            const id = cb.dataset.id;
            if (!id) return;
            if (cb.checked) {
                if (state.compareItems.size < 3) state.compareItems.add(id); else { cb.checked = false; alert('比較できるのは3つまでです。'); }
            } else {
                state.compareItems.delete(id);
            }
            updateCompareBar();
        });
        // ガイドカード
        const guidePopular = document.getElementById('guide-popular');
        const guideCost = document.getElementById('guide-cost');
        const guideQuality = document.getElementById('guide-quality');
        if (guidePopular) guidePopular.addEventListener('click', () => {
            state.filters.reviews = 1000; // レビュー件数閾値
            if (labelReview) labelReview.textContent = String(state.filters.reviews);
            if (filterReview) filterReview.value = state.filters.reviews;
            state.sortBy = 'review';
            updateGuideActive('popular'); updateSortButtonsActive(); applyAll();
            track('guide_click', { type: 'popular' });
        });
        if (guideCost) guideCost.addEventListener('click', () => {
            // 下位40%までの価格上限に近いところへ（簡易）
            const span = (state.priceBounds.max ?? 0) - (state.priceBounds.min ?? 0);
            state.filters.priceMin = 0;
            state.filters.priceMax = Math.round((state.priceBounds.max ?? 0) - span * 0.6);
            if (priceMinInput) priceMinInput.value = state.filters.priceMin;
            if (priceMaxInput) priceMaxInput.value = state.filters.priceMax;
            state.sortBy = 'price';
            updateGuideActive('cost'); updateSortButtonsActive(); applyAll();
            track('guide_click', { type: 'cost' });
        });
        if (guideQuality) guideQuality.addEventListener('click', () => {
            state.filters.rating = 4.4;
            if (labelRating) labelRating.textContent = state.filters.rating.toFixed(1);
            if (filterRating) filterRating.value = state.filters.rating;
            state.sortBy = 'review';
            updateGuideActive('quality'); updateSortButtonsActive(); applyAll();
            track('guide_click', { type: 'quality' });
        });
        // 比較バーのボタン
        if (btnCompare) btnCompare.addEventListener('click', () => { if (state.compareItems.size >= 2) { openCompareModal(); track('compare_open', { ids: Array.from(state.compareItems) }); } });
        if (btnCompareClear) btnCompareClear.addEventListener('click', () => {
            state.compareItems.clear();
            try {
                document.querySelectorAll('.compare-checkbox').forEach(cb => { cb.checked = false; });
            } catch {}
            updateCompareBar();
            track('compare_clear', {});
        });

        // テスティモニアル（クイック検索）
        document.querySelectorAll('.testimonial').forEach(el => {
            el.addEventListener('click', () => {
                const q = el.getAttribute('data-query') || '';
                if (searchBox) searchBox.value = q;
                state.filters.keyword = q;
                const t = (el.getAttribute('data-tags') || '').split(/\s+/).filter(Boolean);
                t.forEach(tag => state.filters.tags.add(tag));
                if (tagsContainer) tagsContainer.querySelectorAll('button[data-tag]').forEach(btn => {
                    btn.classList.toggle('chip-selected', state.filters.tags.has(btn.dataset.tag));
                });
                applyAll();
                track('testimonial_click', { query: q, tags: Array.from(state.filters.tags) });
            });
        });

        // ダークモード（ヘッダーのトグル）
        const applyTheme = (t) => {
            if (t === 'dark') document.documentElement.classList.add('dark');
            else document.documentElement.classList.remove('dark');
            if (btnDarkToggle) {
                const isDark = document.documentElement.classList.contains('dark');
                btnDarkToggle.textContent = isDark ? '☀️ ライト' : '🌙 ダーク';
                btnDarkToggle.setAttribute('aria-pressed', String(isDark));
            }
        };
        const preferred = localStorage.getItem('theme') || 'light';
        applyTheme(preferred);
        if (btnDarkToggle) btnDarkToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            btnDarkToggle.textContent = isDark ? '☀️ ライト' : '🌙 ダーク';
            track('theme_toggle', { theme: isDark ? 'dark' : 'light' });
            applyAll();
        });
    }

    // --- ロジック関数 ---
    function applyAll() {
        try {
            // フィルタリング
            const q = (state.filters.keyword || '').trim().toLowerCase();
            const tags = state.filters.tags || new Set();
            state.filteredProducts = state.products.filter(p => {
                const id = getId(p);
                const keywordHay = `${p.itemName || ''} ${p.catchcopy || ''} ${p.description || ''}`.toLowerCase();
                const keywordOk = !q || keywordHay.includes(q);
                const priceOk = (state.filters.priceMin == null || Number(p.itemPrice || 0) >= state.filters.priceMin) &&
                                (state.filters.priceMax == null || Number(p.itemPrice || 0) <= state.filters.priceMax);
                const ratingOk = Number(p.reviewAverage || 0) >= (state.filters.rating || 0);
                const reviewOk = Number(p.reviewCount || 0) >= (state.filters.reviews || 0);
                const tagsOk = (tags.size === 0) || (Array.isArray(p.tags) && p.tags.some(t => tags.has(String(t))));
                const favOk = !state.filters.favOnly || state.favorites.has(id);
                return keywordOk && priceOk && ratingOk && reviewOk && tagsOk && favOk;
            });

            // スコア付与（おすすめ順用）
            if (state.filteredProducts.length) {
                state.filteredProducts = computeScores(state.filteredProducts);
            }

            // ソート
            state.filteredProducts.sort((a, b) => {
                switch (state.sortBy) {
                    case 'price': return (a.itemPrice || 0) - (b.itemPrice || 0);
                    case 'review': return (b.reviewAverage || 0) - (a.reviewAverage || 0);
                    case 'score': return (b.score || 0) - (a.score || 0);
                    default: return (a.rank || 999) - (b.rank || 999);
                }
            });

            renderProducts(state.filteredProducts);
            updateSortButtonsActive();
            // 現在のデータを保持し、グラフが開いていれば更新
            try { currentData = state.filteredProducts.slice(); } catch {}
            try {
                const detailsEl = document.querySelector('#chart-analysis details');
                if (detailsEl && detailsEl.open) {
                    ensureChart().then((ok)=>{ if (ok) refreshChart(currentData); });
                }
            } catch {}

            // 保存
            saveAppState();
            try { track('list_render', { total: state.filteredProducts.length, sortBy: state.sortBy }); } catch {}
        } catch {}
    }
    
    function toggleFavorite(id) {
        if (state.favorites.has(id)) {
            state.favorites.delete(id);
        } else {
            state.favorites.add(id);
        }
        saveFavorites(state.favorites);
        applyAll(); // 再描画してUIに反映
        try { renderTop3(); } catch {}
    }

    function toggleCompare(id) {
        if (state.compareItems.has(id)) {
            state.compareItems.delete(id);
        } else {
            if (state.compareItems.size < 3) state.compareItems.add(id);
            else alert('比較できるのは3つまでです。');
        }
        updateCompareBar();
    }
    
    function updateCompareBar(){
        if (compareCount) compareCount.textContent = state.compareItems.size;
        if (compareBar) compareBar.classList.toggle('hidden', state.compareItems.size === 0);
        if (btnCompare) btnCompare.disabled = state.compareItems.size < 2;
    }
    
    // --- 初期化 ---
    function init() {
        try { state.products = augmentProducts(state.products); } catch {}
        try { state.priceBounds = computePriceBounds(state.products); } catch {}
        try { restoreAppState(); } catch {}
        try { renderTop3(); } catch {}
        try { applyAll(); } catch {}
        try { addEventListeners(); } catch {}
        // ヘッダー固定分の上余白を付与し、右サイドTOCの開閉を有効化
        try { setupHeaderAndToc(); } catch {}
        // グラフのバインディング
        try { bindDetailsChart(); } catch {}
        try { initTags(); } catch {}
        try { updateSortButtonsActive(); } catch {}
        try { tryLoadExternalData(); } catch {}
        try { bindFaqControls(); } catch {}
        try { initShareBars(); } catch {}
        try { initPwaInstall(); } catch {}
        try { injectJsonLd(); } catch {}
        try { ensureBodyVisible(); } catch {}
        try { registerServiceWorker(); } catch {}
    }

    init();

    // --- ヘッダー/TOCの挙動 ---
    function setupHeaderAndToc(){
        // ヘッダー高さ分の余白
        document.body.classList.add('has-header');
        const header = document.getElementById('site-header');
        if (header) {
            let lastY = window.scrollY || 0;
            let ticking = false;
            window.addEventListener('scroll', () => {
                const y = window.scrollY || 0;
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        if (y > lastY && y > 80) header.classList.add('hide');
                        else header.classList.remove('hide');
                        lastY = y;
                        ticking = false;
                    });
                    ticking = true;
                }
            }, { passive: true });
        }
        // 右サイドTOCの開閉 + ScrollSpy
        const toc = document.getElementById('right-toc');
        const toggle = document.getElementById('toc-toggle');
        if (toc && toggle) {
            // 初期は閉じる
            toc.classList.add('hidden');
            let open = false;
            const setPressed = () => toggle.setAttribute('aria-pressed', String(open));
            toggle.addEventListener('click', () => {
                open = !open;
                toc.classList.toggle('hidden', !open);
                setPressed();
            });
            setPressed();

            // ScrollSpy: 現在地のリンクに active を付与
            const links = Array.from(toc.querySelectorAll('a[href^="#"]'));
            const ids = links.map(a => a.getAttribute('href').slice(1)).filter(Boolean);
            const updateActive = () => {
                let activeIndex = -1;
                let minTop = Infinity;
                ids.forEach((id, i) => {
                    const el = document.getElementById(id);
                    if (!el) return;
                    const rect = el.getBoundingClientRect();
                    if (rect.top >= -120 && rect.top < minTop) { minTop = rect.top; activeIndex = i; }
                });
                links.forEach((a, i) => a.classList.toggle('active', i === activeIndex));
            };
            window.addEventListener('scroll', updateActive, { passive: true });
            window.addEventListener('resize', updateActive, { passive: true });
            updateActive();
        }
    }

    // --- グラフ（details開閉時に初期化/更新） ---
    function bindDetailsChart(){
        const detailsEl = document.querySelector('#chart-analysis details');
        if (!detailsEl) return;
        detailsEl.addEventListener('toggle', () => {
            if (!detailsEl.open) return;
            const list = currentData && currentData.length ? currentData : state.filteredProducts || [];
            ensureChart().then((ok)=>{ if (ok) refreshChart(list); });
        });
        // 初期状態で開いている場合
        if (detailsEl.open) {
            const list = currentData && currentData.length ? currentData : state.filteredProducts || [];
            ensureChart().then((ok)=>{ if (ok) refreshChart(list); });
        }
    }

    // --- FAQ 全開/全閉 ---
    function bindFaqControls() {
        const openAll = document.getElementById('btn-faq-open-all');
        const closeAll = document.getElementById('btn-faq-close-all');
        if (openAll) openAll.addEventListener('click', () => { document.querySelectorAll('#faq details').forEach(d => d.open = true); });
        if (closeAll) closeAll.addEventListener('click', () => { document.querySelectorAll('#faq details').forEach(d => d.open = false); });
    }

    // --- 共有ボタン群 ---
    function openCenteredPopup(url) {
        try {
            const width = 600, height = 680;
            const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;
            const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;
            const screenWidth = window.innerWidth || document.documentElement.clientWidth || screen.width;
            const screenHeight = window.innerHeight || document.documentElement.clientHeight || screen.height;
            const left = dualScreenLeft + (screenWidth - width) / 2;
            const top = dualScreenTop + (screenHeight - height) / 2;
            window.open(url, '_blank', `noopener,noreferrer,width=${width},height=${height},top=${top},left=${left}`);
        } catch { window.open(url, '_blank'); }
    }
    function getPageShareData() {
        const pageTitle = (document.title || '').trim();
        const heading = (document.querySelector('h1')?.textContent || '').trim();
        const text = heading && heading !== pageTitle ? heading : pageTitle;
        const url = `${location.origin}${location.pathname}${location.search}`;
        return { title: pageTitle || 'おすすめまとめ', text: text || pageTitle, url };
    }
    async function handleShareAction(action, btn) {
        const { title, text, url } = getPageShareData();
        if (action === 'native') {
            try { if (navigator.share) { await navigator.share({ title, text, url }); track('share_click', { action }); return; } } catch {}
            return handleShareAction('copy', btn);
        }
        if (action === 'x') {
            const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            openCenteredPopup(shareUrl); track('share_click', { action }); return;
        }
        if (action === 'line') {
            const shareUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}`;
            openCenteredPopup(shareUrl); track('share_click', { action }); return;
        }
        if (action === 'copy') {
            try { await navigator.clipboard.writeText(url); if (btn) { const orig = btn.textContent; btn.textContent = 'コピー済み'; setTimeout(()=>btn.textContent = orig, 1500); } } catch {}
            track('share_click', { action }); return;
        }
    }
    function initShareBars() {
        const buttons = document.querySelectorAll('[data-share-action]');
        buttons.forEach(b => {
            b.addEventListener('click', () => handleShareAction(b.dataset.shareAction, b));
        });
        if (!navigator.share) {
            document.querySelectorAll('[data-share-action="native"]').forEach(el => el.classList.add('hidden'));
        }
    }

    // --- PWA Install ---
    function initPwaInstall() {
        let deferredPrompt = null;
        window.addEventListener('beforeinstallprompt', (e) => {
            try { e.preventDefault(); } catch {}
            deferredPrompt = e;
            if (btnInstall) btnInstall.classList.remove('hidden');
        });
        if (btnInstall) btnInstall.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            try { deferredPrompt.prompt(); await deferredPrompt.userChoice; } catch {}
            deferredPrompt = null; btnInstall.classList.add('hidden');
        });
    }

    // --- JSON-LD 注入（重複防止のためID付与） ---
    function injectJsonLd() {
        try {
            if (document.getElementById('jsonld-itemlist')) return; // 二重注入防止
            const items = Array.isArray(state.products) ? state.products : productsData || [];
            if (!items.length) return;

            const img1200 = (url) => {
                try {
                    const hasQuery = url.includes('?');
                    const exParam = `_ex=1200x1200`;
                    if (/_ex=\d+x\d+/.test(url)) return url.replace(/_ex=\d+x\d+/, exParam);
                    return url + (hasQuery ? '&' : '?') + exParam;
                } catch { return url; }
            };
            const itemList = {
                '@context': 'https://schema.org',
                '@type': 'ItemList',
                name: (document.title || '').trim(),
                description: (document.querySelector('meta[name="description"]')?.content || '').trim(),
                numberOfItems: items.length,
                itemListOrder: 'https://schema.org/ItemListOrderAscending',
                itemListElement: items.map((p, idx) => ({
                    '@type': 'ListItem',
                    position: idx + 1,
                    url: p.affiliateUrl,
                    item: {
                        '@type': 'Product',
                        name: p.itemName,
                        image: [p.imageUrl, img1200(p.imageUrl)],
                        description: p.description || p.catchcopy || '',
                        brand: { '@type': 'Brand', name: '楽天市場' },
                        category: 'レディースファッション',
                        aggregateRating: { '@type': 'AggregateRating', ratingValue: p.reviewAverage, reviewCount: p.reviewCount, bestRating: 5, worstRating: 1 },
                        offers: { '@type': 'Offer', priceCurrency: 'JPY', price: p.itemPrice, lowPrice: p.itemPrice, highPrice: p.itemPrice, url: p.affiliateUrl, availability: 'https://schema.org/InStock', seller: { '@type': 'Organization', name: '楽天市場' } }
                    }
                }))
            };
            const breadcrumb = {
                '@context': 'https://schema.org', '@type': 'BreadcrumbList',
                itemListElement: [
                    { '@type': 'ListItem', position: 1, name: 'ホーム', item: location.origin },
                    { '@type': 'ListItem', position: 2, name: '記事', item: location.origin + '/article/' },
                    { '@type': 'ListItem', position: 3, name: (document.querySelector('h1')?.textContent || '').trim() }
                ]
            };
            const faqEls = Array.from(document.querySelectorAll('#faq details'));
            if (faqEls.length) {
                const faq = {
                    '@context': 'https://schema.org', '@type': 'FAQPage',
                    mainEntity: faqEls.map(d => ({ '@type': 'Question', name: (d.querySelector('summary span')?.textContent || '').trim(), acceptedAnswer: { '@type': 'Answer', text: (d.querySelector('div')?.textContent || '').trim() } }))
                };
                const s3 = document.createElement('script'); s3.id = 'jsonld-faq'; s3.type = 'application/ld+json'; s3.text = JSON.stringify(faq);
                document.head.appendChild(s3);
            }
            const s1 = document.createElement('script'); s1.id = 'jsonld-itemlist'; s1.type = 'application/ld+json'; s1.text = JSON.stringify(itemList);
            const s2 = document.createElement('script'); s2.id = 'jsonld-breadcrumb'; s2.type = 'application/ld+json'; s2.text = JSON.stringify(breadcrumb);
            document.head.appendChild(s1); document.head.appendChild(s2);
        } catch {}
    }

    // --- FOUC対策（ロード後に表示） ---
    function ensureBodyVisible() {
        try {
            document.body.style.display = 'block';
            document.body.classList.add('has-header');
        } catch {}
    }

    function registerServiceWorker() {
        try { if ('serviceWorker' in navigator) navigator.serviceWorker.register('../../sw.js').catch(()=>{}); } catch {}
    }

    // --- 比較モーダル ---
    function ensureCompareModal() {
        let backdrop = document.getElementById('compare-modal-backdrop');
        if (backdrop) return backdrop;
        backdrop = document.createElement('div');
        backdrop.id = 'compare-modal-backdrop';
        backdrop.className = 'modal-backdrop';
        backdrop.style.display = 'none';
        backdrop.innerHTML = `
            <div class="modal p-4 md:p-6" role="dialog" aria-modal="true" aria-label="商品比較">
                <div class="modal-header flex justify-between items-center p-2 md:p-0">
                    <h3 class="text-lg font-bold">商品比較</h3>
                    <button id="compare-modal-close" class="btn border px-3 py-1 rounded-lg">閉じる</button>
                </div>
                <div class="pt-4">
                    <div id="compare-modal-body" class="overflow-x-auto"></div>
                </div>
            </div>`;
        document.body.appendChild(backdrop);
        // 閉じる挙動
        const close = () => { backdrop.style.display = 'none'; document.body.classList.remove('modal-open'); };
        backdrop.addEventListener('click', (e) => { if (e.target === backdrop) close(); });
        backdrop.querySelector('#compare-modal-close').addEventListener('click', close);
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && backdrop.style.display !== 'none') close(); });
        return backdrop;
    }
    function openCompareModal() {
        try {
            const ids = Array.from(state.compareItems);
            const items = state.products.filter(p => ids.includes(getId(p)));
            if (items.length < 2) return;
            const best = {
                price: Math.min(...items.map(p => Number(p.itemPrice || Infinity))),
                rating: Math.max(...items.map(p => Number(p.reviewAverage || 0))),
                reviews: Math.max(...items.map(p => Number(p.reviewCount || 0))),
            };
            const scored = computeScores(items);
            const toStars = (score) => {
                const n = Math.max(0, Math.min(5, Math.round((score || 0) * 5)));
                return '★'.repeat(n) + '☆'.repeat(5 - n);
            };
            const table = `
                <div class="mb-4 p-4 bg-blue-50 rounded-lg text-sm text-blue-800">
                    <p class="font-bold mb-2">📊 比較基準について</p>
                    <p>黄色のハイライトが各項目の最良値です（価格=最安、評価=最高、レビュー=最多）。</p>
                </div>
                <table class="w-full text-sm table-striped">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="text-left p-3 font-bold">比較項目</th>
                            ${items.map(p => `<th class="text-left p-3 font-bold">${String(p.itemName || '').slice(0, 20)}${String(p.itemName || '').length>20?'…':''}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-t">
                            <td class="p-3 font-semibold bg-gray-50">価格（税込）</td>
                            ${items.map(p => `<td class="p-3 ${Number(p.itemPrice||0)===best.price?'bg-yellow-50 ring-2 ring-yellow-200 font-bold':''}">${formatPrice(p.itemPrice)}</td>`).join('')}
                        </tr>
                        <tr class="border-t">
                            <td class="p-3 font-semibold bg-gray-50">評価</td>
                            ${items.map(p => `<td class="p-3 ${Number(p.reviewAverage||0)===best.rating?'bg-yellow-50 ring-2 ring-yellow-200 font-bold':''}">⭐ ${formatRating(p.reviewAverage)} / 5.00</td>`).join('')}
                        </tr>
                        <tr class="border-t">
                            <td class="p-3 font-semibold bg-gray-50">レビュー件数</td>
                            ${items.map(p => `<td class="p-3 ${Number(p.reviewCount||0)===best.reviews?'bg-yellow-50 ring-2 ring-yellow-200 font-bold':''}">${Number(p.reviewCount||0).toLocaleString()}件</td>`).join('')}
                        </tr>
                        <tr class="border-t">
                            <td class="p-3 font-semibold bg-gray-50">機能・特徴</td>
                            ${items.map(p => `<td class="p-3">${(p.tags||[]).map(t=>`<span class='chip'>${t}</span>`).join(' ')}</td>`).join('')}
                        </tr>
                        <tr class="border-t">
                            <td class="p-3 font-semibold bg-gray-50">総合評価</td>
                            ${scored.map(p => `<td class="p-3">${toStars(p.score)}<br><small>(${((p.score||0)*100).toFixed(1)}点)</small></td>`).join('')}
                        </tr>
                    </tbody>
                </table>
                <div class="mt-4 text-xs text-gray-600">
                    <p>※ 価格・在庫は変動します。最新情報は各商品のリンク先でご確認ください。</p>
                    <p>※ 総合評価は当サイト独自のスコア（価格・評価・人気の総合値）です。</p>
                </div>
            `;
            const backdrop = ensureCompareModal();
            const body = backdrop.querySelector('#compare-modal-body');
            body.innerHTML = table;
            backdrop.style.display = 'flex';
            document.body.classList.add('modal-open');
        } catch {}
    }

    // --- 外部JSON読み込み（成功時のみ差し替え） ---
    async function tryLoadExternalData() {
        try {
            const m = location.pathname.match(/\/article\/(series\d+)\/(\d+-\d+)\.html$/);
            if (!m) return;
            const series = m[1];
            const slug = m[2];
            const rel = `../../site_data/${series}/${slug}.json`;
            const res = await fetch(rel, { cache: 'no-cache' });
            if (!res.ok) return;
            const data = await res.json();
            if (!Array.isArray(data) || data.length === 0) return;
            // 差し替え
            state.products = augmentProducts(data);
            state.priceBounds = computePriceBounds(state.products);
            // UI初期化の一部を更新
            if (priceMinInput) priceMinInput.value = '';
            if (priceMaxInput) priceMaxInput.value = '';
            if (priceRangeQuick) priceRangeQuick.value = 0;
            // タグ再構築
            initTags();
            // 再描画
            renderTop3();
            applyAll();
            // データ更新日
            const du = document.getElementById('data-updated');
            if (du) {
                try { du.textContent = new Date().toISOString().slice(0,10); } catch {}
            }
        } catch {}
    }

    // --- 状態の保存/復元 ---
    function saveAppState() {
        try {
            const obj = {
                sortBy: state.sortBy,
                filters: {
                    keyword: state.filters.keyword || '',
                    priceMin: state.filters.priceMin,
                    priceMax: state.filters.priceMax,
                    rating: state.filters.rating,
                    reviews: state.filters.reviews,
                    tags: Array.from(state.filters.tags || []),
                    favOnly: !!state.filters.favOnly,
                },
            };
            localStorage.setItem('state', JSON.stringify(obj));
        } catch {}
    }
    function restoreAppState() {
        try {
            const raw = localStorage.getItem('state');
            if (!raw) return;
            const saved = JSON.parse(raw);
            if (saved.sortBy) state.sortBy = saved.sortBy;
            if (saved.filters) {
                const f = saved.filters;
                state.filters.keyword = f.keyword || '';
                state.filters.priceMin = (f.priceMin ?? null);
                state.filters.priceMax = (f.priceMax ?? null);
                state.filters.rating = Number(f.rating || 0);
                state.filters.reviews = Number(f.reviews || 0);
                state.filters.tags = new Set(Array.isArray(f.tags) ? f.tags : []);
                state.filters.favOnly = !!f.favOnly;
            }
            // UIへ反映
            if (searchBox) searchBox.value = state.filters.keyword || '';
            if (priceMinInput) priceMinInput.value = state.filters.priceMin ?? '';
            if (priceMaxInput) priceMaxInput.value = state.filters.priceMax ?? '';
            if (filterRating) filterRating.value = state.filters.rating || 0;
            if (labelRating) labelRating.textContent = (state.filters.rating || 0).toFixed(1);
            if (filterReview) filterReview.value = state.filters.reviews || 0;
            if (labelReview) labelReview.textContent = String(state.filters.reviews || 0);
            if (favOnlyCheckbox) favOnlyCheckbox.checked = !!state.filters.favOnly;
            if (tagsContainer && state.filters.tags.size) {
                tagsContainer.querySelectorAll('button[data-tag]').forEach(btn => {
                    btn.classList.toggle('chip-selected', state.filters.tags.has(btn.dataset.tag));
                });
            }
        } catch {}
    }
});

    </script>

</body>
</html>
